<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
  <title>Portal Tributario ‚Äî Alcald√≠a de Colombia</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>

    /* ‚ïê‚ïê PORTAL BASE ‚Äî Variables y estilos propios ‚ïê‚ïê */
    :root {
      --red:       #CC1F1F;
      --red-dark:  #A31515;
      --orange:    #E87722;
      --orange-lt: #F5A623;
      --white:     #FFFFFF;
      --text:      #1A1A1A;
      --gray:      #666;
      --gray-lt:   #F5F5F5;
      --border:    #E0E0E0;
    }

    /* Vistas: solo una visible a la vez */
    .vista { display:none; }
    .vista.activa { display:block; }

    /* ‚ïê‚ïê HEADER PORTAL BASE ‚ïê‚ïê */
    .pb-header {
      background:#fff; border-bottom:3px solid var(--red);
      height:60px; display:flex; align-items:center;
      justify-content:space-between; padding:0 28px;
      position:sticky; top:0; z-index:200;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .pb-home-ico { width:42px; height:42px; display:flex; align-items:center; justify-content:center; }
    .pb-icon-home { width:38px; height:38px; }
    .pb-header-center { display:flex; align-items:center; gap:10px; }
    .pb-escudo {
      width:44px; height:44px;
      background:linear-gradient(135deg,#003F87,#1565C0,#FFD700);
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-size:22px; border:2px solid #ccc; box-shadow:0 2px 6px rgba(0,0,0,.15);
    }
    .pb-alcaldia-text { line-height:1.1; }
    .pb-alcaldia-text strong { display:block; font-size:14px; font-weight:700; color:var(--text); }
    .pb-alcaldia-text span   { font-size:12px; color:var(--gray); }
    .pb-btn-acceder {
      display:flex; align-items:center; gap:7px;
      background:var(--red); color:#fff; padding:9px 20px;
      border-radius:6px; font-size:13.5px; font-weight:600; transition:.2s; border:none; cursor:pointer;
    }
    .pb-btn-acceder:hover { background:var(--red-dark); }

    /* ‚ïê‚ïê CAROUSEL ‚ïê‚ïê */
    .pb-carousel {
      position:relative; overflow:hidden;
      background:linear-gradient(160deg, #D0D0D0 0%, #E8E8E8 40%, #F0F0F0 60%, #D0D0D0 100%);
      height:320px;
    }
    .pb-carousel-slide {
      width:100%; height:100%; display:flex; align-items:center; justify-content:center;
    }
    .pb-brand { display:flex; align-items:center; gap:18px; }
    .pb-brand-title {
      font-size:clamp(28px,4vw,48px); font-weight:900; color:var(--text); line-height:1.05; letter-spacing:-1px;
    }
    .pb-carousel-escudo {
      width:80px; height:80px;
      background:linear-gradient(135deg,#003F87 0%,#1565C0 40%,#FFD700 100%);
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-size:42px; border:3px solid rgba(255,255,255,.4); box-shadow:0 6px 20px rgba(0,0,0,.2);
    }
    .pb-carousel-alcaldia { line-height:1.1; }
    .pb-carousel-alcaldia strong { display:block; font-size:22px; font-weight:700; color:var(--text); }
    .pb-carousel-alcaldia span   { font-size:16px; color:var(--gray); }
    .pb-carousel-stripe {
      position:absolute; bottom:0; left:0; right:0;
      height:18px; background:linear-gradient(90deg, var(--orange), var(--orange-lt));
    }
    .pb-nav {
      position:absolute; top:50%; transform:translateY(-50%);
      width:36px; height:36px; border-radius:50%; background:rgba(255,255,255,.6);
      display:flex; align-items:center; justify-content:center;
      font-size:16px; color:var(--gray); cursor:pointer;
      border:1px solid rgba(0,0,0,.1); transition:.2s;
    }
    .pb-nav:hover { background:rgba(255,255,255,.9); }
    .pb-nav.prev { left:16px; } .pb-nav.next { right:16px; }
    .pb-dots { position:absolute; bottom:26px; left:50%; transform:translateX(-50%); display:flex; gap:8px; }
    .pb-dot { width:28px; height:6px; border-radius:3px; background:rgba(0,0,0,.2); transition:.2s; }
    .pb-dot.active { background:var(--orange); }

    /* ‚ïê‚ïê BANNER AYUDA ‚ïê‚ïê */
    .pb-banner {
      margin:32px 40px;
      background:linear-gradient(110deg, var(--red-dark) 0%, var(--red) 45%, var(--orange) 100%);
      border-radius:16px; padding:28px 36px;
      display:flex; align-items:center; justify-content:space-between;
      position:relative; overflow:hidden; cursor:pointer;
      transition:transform .2s, box-shadow .2s;
      box-shadow:0 8px 24px rgba(0,0,0,.12);
    }
    .pb-banner:hover { transform:translateY(-2px); box-shadow:0 12px 32px rgba(0,0,0,.18); }
    .pb-banner::before {
      content:''; position:absolute; inset:0;
      background-image:
        radial-gradient(circle at 20% 50%, rgba(255,255,255,.06) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.08) 0%, transparent 40%);
      pointer-events:none;
    }
    .pb-banner-left { display:flex; align-items:center; gap:18px; z-index:1; }
    .pb-play-ico {
      width:42px; height:42px; border-radius:50%; border:2.5px solid rgba(255,255,255,.5);
      display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.12);
    }
    .pb-play-ico svg { width:16px; height:16px; fill:#fff; margin-left:2px; }
    .pb-banner-text h3 { font-size:18px; font-weight:700; color:#fff; margin-bottom:3px; }
    .pb-banner-text p  { font-size:13px; color:rgba(255,255,255,.8); font-weight:300; }
    .pb-btn-videos {
      display:flex; align-items:center; gap:8px; z-index:1;
      background:#fff; color:var(--red); padding:11px 24px; border-radius:100px;
      font-size:13.5px; font-weight:700; border:none; cursor:pointer; transition:.2s;
      box-shadow:0 4px 14px rgba(0,0,0,.15); font-family:'Poppins',sans-serif;
    }
    .pb-btn-videos svg { width:14px; height:14px; fill:var(--red); flex-shrink:0; }
    .pb-btn-videos:hover { background:var(--red); color:#fff; }
    .pb-btn-videos:hover svg { fill:#fff; }

    /* ‚ïê‚ïê SERVICIOS ‚ïê‚ïê */
    .pb-servicios { padding:0 40px 48px; }
    .pb-servicios-title {
      text-align:center; font-size:clamp(24px,3vw,34px); font-weight:700;
      color:var(--red); margin-bottom:32px;
    }
    .pb-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:18px; }
    .pb-card {
      position:relative; border-radius:12px; overflow:hidden;
      aspect-ratio:16/9; cursor:pointer;
      box-shadow:0 4px 14px rgba(0,0,0,.12); transition:transform .22s, box-shadow .22s;
    }
    .pb-card:hover { transform:translateY(-4px); box-shadow:0 10px 28px rgba(0,0,0,.2); }
    .pb-card-bg { width:100%; height:100%; position:relative; }
    .pb-card-bg::after {
      content:''; position:absolute; inset:0;
      background:linear-gradient(to bottom, transparent 30%, rgba(0,0,0,.6) 100%);
    }
    .pb-card-label {
      position:absolute; bottom:0; left:0; right:0;
      padding:12px 14px 14px;
      color:#fff; font-size:14px; font-weight:500; line-height:1.3; z-index:1;
    }
    .bg-1 { background:linear-gradient(135deg,#4a4a4a,#8a8a8a,#c0c0c0); }
    .bg-2 { background:linear-gradient(135deg,#6b8c9a,#9bb5c0,#d0e0e8); }
    .bg-3 { background:linear-gradient(135deg,#3a5a7a,#6a8aaa,#b0c8d8); }
    .bg-4 { background:linear-gradient(135deg,#5a7a3a,#8aaa6a,#c0d8b0); }
    .bg-5 { background:linear-gradient(135deg,#3a5a8a,#6a8aba,#9ab0cc); }
    .bg-6 { background:linear-gradient(135deg,#4a3a5a,#7a6a8a,#b0a0c0); }
    .bg-7 { background:linear-gradient(135deg,#5a4a3a,#8a7a6a,#c0b0a0); }
    .bg-8 { background:linear-gradient(135deg,#3a4a5a,#6a7a8a,#a0b0c0); }
    .bg-9 { background:linear-gradient(135deg,#5a3a4a,#8a6a7a,#c0a0b0); }
    .bg-10{ background:linear-gradient(135deg,#3a5a6a,#6a8a9a,#a0c0cc); }
    .bg-11{ background:linear-gradient(135deg,#4a5a3a,#7a8a6a,#b0c0a0); }

    /* ‚ïê‚ïê FOOTER PORTAL BASE ‚ïê‚ïê */
    .pb-footer {
      background:var(--red); color:rgba(255,255,255,.85);
      padding:36px 40px; text-align:center;
    }
    .pb-footer-logo {
      font-size:28px; font-weight:900; letter-spacing:-1px; color:#fff;
      margin-bottom:8px; display:flex; align-items:center; justify-content:center; gap:4px;
    }
    .pb-footer-logo .logo-m { color:rgba(255,255,255,.6); }
    .pb-footer p { font-size:12.5px; margin-top:6px; opacity:.8; }
    .pb-footer-version { font-size:11px; opacity:.55; margin-top:4px; }

    /* Bot√≥n flotante naranja */


    /* ‚ïê‚ïê TRANSICI√ìN DE VISTA ‚ïê‚ïê */
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
    .vista.activa { animation:fadeIn .3s ease; }

    /* ‚îÄ‚îÄ Barra de regreso desde Centro de Ayuda ‚îÄ‚îÄ */
    .back-bar {
      background:linear-gradient(90deg, var(--red-dark), var(--red));
      color:#fff; padding:10px 28px;
      display:flex; align-items:center; gap:12px;
      font-size:13px; font-weight:500; position:sticky; top:0; z-index:400;
    }
    .back-bar-btn {
      display:flex; align-items:center; gap:6px;
      background:rgba(255,255,255,.18); border:1px solid rgba(255,255,255,.3);
      color:#fff; padding:5px 14px; border-radius:100px; font-family:'Poppins',sans-serif;
      font-size:12px; font-weight:700; cursor:pointer; transition:.15s;
    }
    .back-bar-btn:hover { background:rgba(255,255,255,.3); }
    .back-bar-sep { opacity:.4; }

    @media(max-width:768px) {
      .pb-grid { grid-template-columns:repeat(2,1fr); }
      .pb-banner { flex-direction:column; gap:20px; align-items:flex-start; }
    }
    @media(max-width:480px) {
      .pb-grid { grid-template-columns:1fr; }
      .pb-servicios, .pb-banner { margin:16px; }
    }


    /* ‚îÄ‚îÄ Variables globales ‚îÄ‚îÄ */
    :root {
      /*
       * Paleta corporativa roja/naranja ‚Äî versi√≥n suavizada para reducir fatiga visual.
       * T√©cnica: mismo matiz (hue), saturaci√≥n -30%, luminosidad +12%.
       * Resultado: terracota institucional c√°lido, no agresivo.
       */
      --blue:        #C9735F;   /* Coral rojizo suave ‚Äî identidad sin agresividad  */
      --blue-dark:   #A55644;   /* Coral oscuro ‚Äî hover y textos activos            */
      --blue-mid:    #B76452;
      --blue-light:  #FAEEEB;   /* Rosa coral muy p√°lido ‚Äî fondos hover/activo      */
      --blue-xlight: #FDF8F7;   /* Blanco con toque coral ‚Äî fondos seleccionado     */
      --gold:        #D4935A;   /* Melocot√≥n/√°mbar suave ‚Äî naranja desaturado       */
      --gold-light:  #FBF2E8;
      --white:       #FFFFFF;
      --bg:          #FAF9F8;   /* Blanco roto muy c√°lido ‚Äî fondo principal         */
      --text:        #2A2220;   /* Casi negro con tinte c√°lido ‚Äî alta legibilidad   */
      --gray:        #72655F;   /* Gris c√°lido medio                                */
      --gray-light:  #E6DFDB;   /* Bordes suaves con warmth                         */
      --gray-xlight: #F3EFED;   /* Fondos tabla y sidebar                           */
      --red:         #C9735F;
      --green:       #2E7D52;
      --shadow-sm:   0 1px 4px rgba(80,40,30,.07);
      --shadow:      0 4px 16px rgba(80,40,30,.09);
      --shadow-lg:   0 12px 40px rgba(80,40,30,.12);
      --r:           12px;
    }

    /* ‚îÄ‚îÄ Reset ‚îÄ‚îÄ */
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Poppins',sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden; }
    a { text-decoration:none; color:inherit; }
    button { font-family:'Poppins',sans-serif; cursor:pointer; border:none; }
    input, select { font-family:'Poppins',sans-serif; }

    /* ‚îÄ‚îÄ Loader ‚îÄ‚îÄ */
    #loader {
      position:fixed; inset:0; background:#fff;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      z-index:9999; transition:opacity .4s;
    }
    #loader.hidden { opacity:0; pointer-events:none; }
    .loader-logo {
      width:64px; height:64px; border-radius:16px;
      background:linear-gradient(135deg,#A5564A,#C9735F);
      display:flex; align-items:center; justify-content:center;
      font-size:28px; margin-bottom:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.10);
    }
    .loader-bar-wrap {
      width:180px; height:4px; background:var(--gray-light); border-radius:4px; overflow:hidden;
    }
    .loader-bar {
      height:100%; background:linear-gradient(90deg,var(--blue),var(--gold));
      border-radius:4px; animation:load 1s ease forwards;
    }
    @keyframes load { from{width:0} to{width:100%} }
    .loader-text { font-size:12px; color:var(--gray); margin-top:12px; font-weight:400; }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .header {
      background:var(--white); border-bottom:2px solid var(--gray-light);
      position:sticky; top:0; z-index:300; box-shadow:var(--shadow-sm);
    }
    .header-inner {
      max-width:1280px; margin:auto;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 28px; height:64px;
    }
    .brand { display:flex; align-items:center; gap:13px; }
    .brand-logo {
      width:42px; height:42px; border-radius:10px;
      background:linear-gradient(135deg,#A5564A,#C9735F);
      display:flex; align-items:center; justify-content:center;
      font-size:20px; flex-shrink:0;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
    }
    .brand-texts strong { font-size:14px; font-weight:700; color:var(--blue-dark); display:block; }
    .brand-texts span { font-size:11px; color:var(--gray); font-weight:400; }
    .header-right { display:flex; align-items:center; gap:8px; }
    .btn-admin {
      display:flex; align-items:center; gap:6px;
      padding:8px 16px; border-radius:9px;
      background:transparent; border:2px solid var(--gray-light);
      color:var(--blue-dark); font-size:12.5px; font-weight:600;
      transition:.2s;
    }
    .btn-admin:hover { background:var(--blue-light); border-color:var(--blue); }

    /* ‚îÄ‚îÄ Hero banner ‚Äî fondo oscuro neutro, rojo como acento ‚îÄ‚îÄ */
    .hero {
      background:linear-gradient(130deg,#8B4A3A 0%,#C1705A 55%,#D4935A 100%);
      position:relative; overflow:hidden; padding:52px 28px 56px;
    }
    .hero-pattern {
      position:absolute; inset:0; pointer-events:none;
      background-image:
        radial-gradient(circle,rgba(255,255,255,.05) 1px,transparent 1px);
      background-size:28px 28px;
    }
    /* C√≠rculos decorativos de fondo */
    .hero-circle-1 {
      position:absolute; right:-80px; top:-80px;
      width:320px; height:320px; border-radius:50%;
      background:rgba(255,255,255,.04); pointer-events:none;
    }
    .hero-circle-2 {
      position:absolute; right:120px; bottom:-100px;
      width:200px; height:200px; border-radius:50%;
      background:rgba(245,166,35,.12); pointer-events:none;
    }
    .hero-inner {
      max-width:1280px; margin:auto; position:relative; z-index:1;
      display:flex; align-items:center; justify-content:space-between; gap:40px;
    }
    .hero-text { color:#fff; }
    .hero-breadcrumb {
      font-size:11.5px; font-weight:500; color:rgba(255,255,255,.6);
      margin-bottom:14px; display:flex; align-items:center; gap:6px;
    }
    .hero-breadcrumb span { color:rgba(255,255,255,.35); }
    .hero-text h1 {
      font-size:clamp(22px,3vw,36px); font-weight:800; line-height:1.15;
      margin-bottom:12px;
    }
    .hero-text h1 em { font-style:normal; color:var(--gold); }
    .hero-text p { font-size:14.5px; opacity:.78; font-weight:300; line-height:1.7; max-width:480px; }
    /* Tarjetas de estad√≠sticas en el hero */
    .hero-stats { display:flex; gap:16px; flex-shrink:0; }
    .hero-stat {
      background:rgba(255,255,255,.1); backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.15); border-radius:14px;
      padding:18px 22px; text-align:center; min-width:110px;
    }
    .hero-stat-n { font-size:28px; font-weight:800; color:#fff; line-height:1; }
    .hero-stat-l { font-size:11px; color:rgba(255,255,255,.65); font-weight:400; margin-top:5px; }

    /* ‚îÄ‚îÄ Buscador principal ‚îÄ‚îÄ */
    .search-bar {
      max-width:1280px; margin:0 auto; padding:0 28px;
      transform:translateY(-24px);
    }
    .search-inner {
      background:#fff; border-radius:14px;
      box-shadow:var(--shadow-lg);
      display:flex; align-items:center; gap:0; overflow:hidden;
      border:2px solid var(--gray-light);
    }
    .search-inner:focus-within { border-color:var(--blue); }
    .search-icon { padding:0 16px; font-size:18px; color:var(--gray); flex-shrink:0; }
    .search-inner input {
      flex:1; padding:15px 0; border:none; outline:none;
      font-size:14px; color:var(--text); background:transparent;
    }
    .search-inner input::placeholder { color:var(--gray); }
    .search-clear {
      padding:0 16px; font-size:18px; color:var(--gray); cursor:pointer;
      background:none; display:none;
    }
    .search-clear.visible { display:block; }

    /* ‚îÄ‚îÄ Tabs de m√≥dulo (Manuales / Videos) ‚îÄ‚îÄ */
    .tabs-wrap { max-width:1280px; margin:0 auto; padding:0 28px 24px; }
    .tabs { display:flex; gap:8px; border-bottom:2px solid var(--gray-light); padding-bottom:0; }
    .tab {
      padding:11px 24px; border-radius:10px 10px 0 0; font-size:13.5px; font-weight:600;
      color:var(--gray); background:transparent; border:none; cursor:pointer;
      position:relative; transition:.2s; border-bottom:3px solid transparent; margin-bottom:-2px;
    }
    .tab:hover { color:var(--blue); background:var(--blue-xlight); }
    .tab.active { color:var(--blue-dark); border-bottom-color:var(--blue); background:var(--blue-xlight); }
    .tab .tab-count {
      display:inline-block; background:var(--blue-light); color:var(--blue);
      font-size:10px; font-weight:700; padding:2px 7px; border-radius:100px;
      margin-left:6px;
    }
    .tab.active .tab-count { background:var(--blue); color:#fff; }

    /* ‚îÄ‚îÄ Contenedor de contenido ‚îÄ‚îÄ */
    .content-wrap { max-width:1280px; margin:0 auto; padding:0 28px 60px; display:flex; gap:28px; }

    /* ‚îÄ‚îÄ Sidebar de secciones ‚îÄ‚îÄ */
    .sidebar {
      width:240px; flex-shrink:0;
      background:#fff; border-radius:var(--r); box-shadow:var(--shadow-sm);
      border:2px solid var(--gray-light); padding:16px 0; height:fit-content;
      position:sticky; top:84px;
    }
    .sidebar-title {
      font-size:10px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase;
      color:var(--gray); padding:0 16px 12px;
      border-bottom:1px solid var(--gray-light); margin-bottom:8px;
    }
    /* Item de secci√≥n padre (ej: "1 - Datos b√°sicos") */
    .sec-item {
      display:flex; align-items:center; gap:8px;
      padding:9px 16px; cursor:pointer; transition:.15s; font-size:13px; font-weight:600;
      color:var(--text); border-left:3px solid transparent;
    }
    .sec-item:hover { background:var(--blue-xlight); color:var(--blue); border-left-color:var(--blue-light); }
    .sec-item.active { background:var(--blue-xlight); color:var(--blue-dark); border-left-color:var(--blue); }
    .sec-item-icon { font-size:15px; flex-shrink:0; }
    .sec-item-label { flex:1; line-height:1.3; }
    .sec-item-badge {
      background:var(--blue-light); color:var(--blue); font-size:9.5px;
      font-weight:700; padding:1px 6px; border-radius:100px; flex-shrink:0;
    }
    .sec-item.active .sec-item-badge { background:var(--blue); color:#fff; }

    /* ‚îÄ‚îÄ √Årea principal ‚îÄ‚îÄ */
    .main-area { flex:1; min-width:0; }

    /* ‚îÄ‚îÄ Secci√≥n de manuales / videos ‚îÄ‚îÄ */
    .seccion-bloque { margin-bottom:36px; }
    .seccion-header {
      display:flex; align-items:center; gap:12px;
      margin-bottom:16px; padding-bottom:12px;
      border-bottom:2px solid var(--gray-light);
    }
    .seccion-num {
      width:34px; height:34px; border-radius:9px; flex-shrink:0;
      background:var(--blue);
      display:flex; align-items:center; justify-content:center;
      font-size:13px; font-weight:800; color:#fff;
    }
    .seccion-title { font-size:16px; font-weight:700; color:var(--blue-dark); }
    .seccion-sub { font-size:12px; color:var(--gray); font-weight:400; margin-top:1px; }

    /* ‚îÄ‚îÄ Tarjeta de manual ‚îÄ‚îÄ */
    .items-grid { display:flex; flex-direction:column; gap:8px; }
    .manual-card {
      background:#fff; border-radius:10px; border:2px solid var(--gray-light);
      display:flex; align-items:center; gap:14px; padding:14px 18px;
      cursor:pointer; transition:all .2s; position:relative; overflow:hidden;
    }
    .manual-card:hover {
      border-color:var(--blue); box-shadow:var(--shadow-sm);
      transform:translateX(3px);
    }
    .manual-card-accent {
      position:absolute; left:0; top:0; bottom:0; width:4px;
      background:linear-gradient(180deg,var(--blue),var(--gold));
      opacity:0; transition:.2s;
    }
    .manual-card:hover .manual-card-accent { opacity:1; }
    .manual-card-icon {
      width:40px; height:40px; border-radius:10px; flex-shrink:0;
      background:var(--gray-xlight);
      display:flex; align-items:center; justify-content:center; font-size:18px;
    }
    .manual-card-info { flex:1; min-width:0; }
    .manual-card-num { font-size:10px; font-weight:700; color:var(--blue); text-transform:uppercase; letter-spacing:.5px; }
    .manual-card-name { font-size:13.5px; font-weight:600; color:var(--text); margin-top:1px; }
    .manual-card-meta { font-size:11px; color:var(--gray); font-weight:400; margin-top:2px; }
    .manual-card-btn {
      width:34px; height:34px; border-radius:8px; flex-shrink:0;
      background:var(--blue); color:#fff;
      display:flex; align-items:center; justify-content:center; font-size:16px;
      transition:.2s;
    }
    .manual-card:hover .manual-card-btn { background:var(--blue-dark); }
    .manual-card.oculto { display:none; }

    /* ‚îÄ‚îÄ Tarjeta de video ‚îÄ‚îÄ */
    .video-card {
      background:#fff; border-radius:10px; border:2px solid var(--gray-light);
      display:flex; align-items:center; gap:14px; padding:14px 18px;
      cursor:pointer; transition:all .2s; position:relative; overflow:hidden;
    }
    .video-card:hover { border-color:var(--blue); box-shadow:var(--shadow-sm); transform:translateX(3px); }
    .video-card-accent {
      position:absolute; left:0; top:0; bottom:0; width:4px;
      background:linear-gradient(180deg,var(--blue),var(--gold));
      opacity:0; transition:.2s;
    }
    .video-card:hover .video-card-accent { opacity:1; }
    .video-card-thumb {
      width:40px; height:40px; border-radius:10px; flex-shrink:0;
      background:linear-gradient(135deg,#FEE2E2,#FECACA);
      display:flex; align-items:center; justify-content:center; font-size:20px;
    }
    .video-card-info { flex:1; min-width:0; }
    .video-card-num { font-size:10px; font-weight:700; color:var(--blue); text-transform:uppercase; letter-spacing:.5px; }
    .video-card-name { font-size:13.5px; font-weight:600; color:var(--text); margin-top:1px; }
    .video-card-meta { font-size:11px; color:var(--gray); font-weight:400; margin-top:2px; }
    .video-card-btn {
      width:34px; height:34px; border-radius:8px; flex-shrink:0;
      background:var(--blue); color:#fff;
      display:flex; align-items:center; justify-content:center; font-size:14px;
      transition:.2s;
    }
    .video-card:hover .video-card-btn { background:var(--blue-dark); }

    /* Mensaje vac√≠o cuando no hay resultados en b√∫squeda */
    .empty-state {
      text-align:center; padding:48px 24px; color:var(--gray);
      display:none;
    }
    .empty-state.visible { display:block; }
    .empty-state-icon { font-size:48px; margin-bottom:12px; }
    .empty-state p { font-size:14px; font-weight:400; }

    /* ‚îÄ‚îÄ Overlay base de modales ‚îÄ‚îÄ */
    .overlay {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,.55); backdrop-filter:blur(6px);
      z-index:800; align-items:center; justify-content:center; padding:20px;
    }
    .overlay.open { display:flex; }
    @keyframes mUp {
      from { transform:translateY(24px); opacity:0 }
      to   { transform:none; opacity:1 }
    }

    /* ‚îÄ‚îÄ Modal base ‚îÄ‚îÄ */
    .modal {
      background:#fff; border-radius:18px; width:100%;
      display:flex; flex-direction:column; overflow:hidden;
      box-shadow:0 40px 100px rgba(0,0,0,.12);
      animation:mUp .28s cubic-bezier(.4,0,.2,1);
    }
    .modal-head {
      background:linear-gradient(120deg,#A5564A,#C9735F);
      color:#fff; padding:22px 28px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .mh-left { display:flex; align-items:center; gap:13px; }
    .mh-ico {
      width:44px; height:44px; border-radius:12px; flex-shrink:0;
      background:rgba(255,255,255,.15);
      display:flex; align-items:center; justify-content:center; font-size:20px;
    }
    .mh-title { font-size:17px; font-weight:700; }
    .mh-sub { font-size:12px; opacity:.7; margin-top:2px; font-weight:300; }
    .btn-mclose {
      width:32px; height:32px; border-radius:8px; background:rgba(255,255,255,.15);
      color:#fff; font-size:16px; display:flex; align-items:center; justify-content:center;
      cursor:pointer; border:none; transition:.2s; flex-shrink:0;
    }
    .btn-mclose:hover { background:rgba(255,255,255,.28); }

    /* ‚îÄ‚îÄ Visor de PDF (PDF.js ‚Äî sin descarga ni impresi√≥n) ‚îÄ‚îÄ */
    #m-pdf .modal { max-width:900px; max-height:92vh; display:flex; flex-direction:column; }
    .pdf-head {
      background:linear-gradient(120deg,#A5564A,#C9735F); color:#fff; padding:14px 22px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      flex-shrink:0;
    }
    .pdf-head strong { font-size:14px; font-weight:600; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .pdf-actions { display:flex; gap:7px; flex-shrink:0; }
    .pdf-action-btn {
      padding:6px 14px; border-radius:7px; font-size:12px; font-weight:600;
      background:rgba(255,255,255,.15); color:#fff; border:none; cursor:pointer; transition:.2s;
    }
    .pdf-action-btn:hover { background:rgba(255,255,255,.28); }

    /* √Årea de scroll del canvas */
    .pdf-body {
      flex:1; background:#525659; overflow-y:auto; overflow-x:auto;
      display:flex; flex-direction:column; align-items:center;
      padding:20px 16px; gap:12px; min-height:0;
      /* Bloquea clic derecho visualmente (JS lo bloquea funcionalmente) */
      user-select:none; -webkit-user-select:none;
    }
    .pdf-body canvas {
      display:block; box-shadow:0 4px 18px rgba(0,0,0,.45);
      max-width:100%; height:auto;
    }

    /* Barra de navegaci√≥n de p√°ginas */
    .pdf-nav {
      background:linear-gradient(120deg,#A5564A,#C9735F); color:#fff;
      display:flex; align-items:center; justify-content:center; gap:14px;
      padding:10px 20px; flex-shrink:0;
    }
    .pdf-nav button {
      background:rgba(255,255,255,.18); border:none; color:#fff;
      width:32px; height:32px; border-radius:7px; font-size:16px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:.18s;
    }
    .pdf-nav button:hover:not(:disabled) { background:rgba(255,255,255,.32); }
    .pdf-nav button:disabled { opacity:.35; cursor:default; }
    .pdf-nav span { font-size:13px; font-weight:600; min-width:90px; text-align:center; }

    /* Placeholder sin PDF */
    .pdf-placeholder {
      flex:1; display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      color:rgba(255,255,255,.6); text-align:center; padding:32px; gap:10px;
    }
    .pdf-placeholder .big-icon { font-size:56px; }
    .pdf-placeholder p { font-size:13.5px; }
    .pdf-placeholder small { font-size:11.5px; opacity:.6; }

    /* ‚îÄ‚îÄ Modal Video ‚îÄ‚îÄ */
    #m-video .modal { max-width:700px; }
    .video-embed-wrap {
      padding:24px 28px; background:var(--bg);
      display:flex; flex-direction:column; gap:16px;
    }
    .video-link-box {
      background:#fff; border-radius:11px; border:2px solid var(--gray-light);
      padding:14px 16px; display:flex; align-items:center; gap:12px;
    }
    .video-link-icon { font-size:28px; flex-shrink:0; }
    .video-link-info { flex:1; min-width:0; }
    .video-link-name { font-size:13.5px; font-weight:600; color:var(--text); }
    .video-link-url { font-size:11.5px; color:var(--blue); font-weight:400; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .btn-open-yt {
      display:flex; align-items:center; gap:6px;
      padding:8px 16px; border-radius:8px;
      background:var(--blue); color:#fff; font-size:12.5px; font-weight:700;
      border:none; cursor:pointer; flex-shrink:0; transition:.2s;
    }
    .btn-open-yt:hover { background:var(--blue-dark); }
    .video-note {
      font-size:12px; color:var(--gray); text-align:center;
      padding:12px 16px; background:#fff; border-radius:10px;
      border:1.5px solid var(--gray-light);
    }

    /* ‚îÄ‚îÄ Modal Login ‚îÄ‚îÄ */
    #m-login .modal { max-width:420px; }
    .login-body { padding:28px; }
    .form-group { margin-bottom:16px; }
    .form-label {
      font-size:11px; font-weight:700; color:var(--gray);
      text-transform:uppercase; letter-spacing:1px; display:block; margin-bottom:6px;
    }
    .form-input {
      width:100%; padding:11px 14px; border:2px solid var(--gray-light);
      border-radius:9px; font-size:13.5px; outline:none; transition:.2s; color:var(--text);
    }
    .form-input:focus { border-color:var(--blue); }
    .btn-primary {
      width:100%; padding:13px; background:var(--blue); color:#fff;
      border:none; border-radius:9px; font-size:14px; font-weight:700;
      cursor:pointer; transition:.2s;
    }
    .btn-primary:hover { background:var(--blue-dark); }
    .login-note { text-align:center; font-size:11px; color:var(--gray); margin-top:14px; }
    .alert-error {
      background:#FEE2E2; border:1.5px solid #FCA5A5; color:#991B1B;
      padding:10px 14px; border-radius:9px; font-size:13px; margin-bottom:16px; display:none;
    }

    /* ‚îÄ‚îÄ Modal Admin ‚îÄ‚îÄ */
    #m-admin .modal { max-width:960px; max-height:90vh; }
    .admin-toolbar {
      padding:14px 22px; border-bottom:2px solid var(--gray-light);
      display:flex; align-items:center; gap:12px; flex-wrap:wrap; background:#FAFAFA;
    }
    .btn-add {
      display:flex; align-items:center; gap:6px; padding:9px 18px;
      background:var(--blue); color:#fff; border:none; border-radius:9px;
      font-size:13px; font-weight:700; cursor:pointer; transition:.2s; white-space:nowrap;
    }
    .btn-add:hover { background:var(--blue-dark); }
    .admin-search {
      flex:1; max-width:280px; position:relative;
    }
    .admin-search input {
      width:100%; padding:8px 12px 8px 36px; border:2px solid var(--gray-light);
      border-radius:8px; font-size:13px; outline:none;
    }
    .admin-search::before { content:'üîç'; position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:14px; }
    .admin-body { overflow:auto; flex:1; }
    .admin-table { width:100%; border-collapse:collapse; font-size:13px; table-layout:fixed; }
    .admin-table th {
      padding:11px 14px; text-align:left; font-size:10.5px; font-weight:700;
      color:var(--gray); letter-spacing:1px; text-transform:uppercase;
      background:var(--gray-xlight); border-bottom:2px solid var(--gray-light);
      white-space:nowrap;
    }
    .admin-table td { padding:12px 14px; border-bottom:1px solid var(--gray-light); vertical-align:middle; }
    .admin-table tr:hover td { background:#F8FAFF; }
    .col-ico  { width:52px; }
    .col-sec  { width:110px; }
    .col-name { }
    .col-ver  { width:75px; }
    .col-date { width:105px; }
    .col-st   { width:90px; text-align:center; }
    .col-act  { width:110px; text-align:center; }
    .badge-vis {
      display:inline-block; padding:3px 10px; border-radius:100px;
      font-size:10.5px; font-weight:700; white-space:nowrap;
    }
    .badge-vis.on  { background:#DCFCE7; color:#16A34A; border:1px solid #86EFAC; }
    .badge-vis.off { background:#F1F5F9; color:var(--gray); border:1px solid var(--gray-light); }
    .action-btns { display:flex; gap:5px; justify-content:center; }
    .act-btn {
      width:32px; height:32px; border-radius:7px; border:1.5px solid;
      display:flex; align-items:center; justify-content:center;
      font-size:15px; cursor:pointer; transition:.15s;
    }
    .act-btn.edit   { background:var(--blue-light); border-color:#BFDBFE; color:var(--blue); }
    .act-btn.edit:hover { background:#BFDBFE; }
    .act-btn.vis    { background:#FFF7ED; border-color:#FED7AA; color:#C2410C; }
    .act-btn.vis:hover { background:#FFEDD5; }
    .act-btn.show   { background:#F0FDF4; border-color:#86EFAC; color:#16A34A; }
    .act-btn.show:hover { background:#DCFCE7; }
    .act-btn.del    { background:#FEF2F2; border-color:#FBBFBA; color:#B03020; }
    .act-btn.del:hover { background:#FEE2E2; }
    .admin-foot {
      padding:12px 22px; border-top:2px solid var(--gray-light);
      display:flex; align-items:center; justify-content:space-between;
      font-size:12px; color:var(--gray); background:#FAFBFF;
    }

    /* ‚îÄ‚îÄ Modal Form (Agregar/Editar) ‚îÄ‚îÄ */
    #m-form .modal { max-width:520px; max-height:92vh; }
    .form-body { padding:24px 28px; overflow-y:auto; flex:1; }
    .icon-picker { display:flex; flex-wrap:wrap; gap:7px; margin-top:6px; }
    .ico-opt {
      width:36px; height:36px; border-radius:8px; border:2px solid var(--gray-light);
      background:#fff; font-size:18px; cursor:pointer; transition:.15s;
      display:flex; align-items:center; justify-content:center;
    }
    .ico-opt:hover { border-color:var(--blue); background:var(--blue-light); }
    .ico-opt.selected { border-color:var(--blue); background:var(--blue-light); }

    /* Zona de adjunto PDF */
    .pdf-drop {
      border:2px dashed var(--gray-light); border-radius:10px;
      padding:18px 14px; text-align:center; cursor:pointer; transition:.2s; background:#FAFBFF;
    }
    .pdf-drop:hover { border-color:var(--blue); background:var(--blue-xlight); }
    .pdf-drop.has-file { border-color:var(--green); background:#F0FDF4; }
    .pdf-drop-icon { font-size:28px; margin-bottom:6px; }
    .pdf-drop-label { font-size:13px; color:var(--gray); }
    .pdf-info {
      display:none; margin-top:10px; padding:10px 14px;
      background:#F0FDF4; border:1.5px solid #86EFAC; border-radius:9px;
      align-items:center; gap:10px;
    }
    .pdf-info.visible { display:flex; }
    .pdf-info-name { font-size:13px; font-weight:600; color:var(--blue-dark); flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .pdf-info-size { font-size:11px; color:var(--gray); }
    .pdf-remove { background:none; border:none; font-size:16px; color:var(--gray); cursor:pointer; }

    /* ‚îÄ‚îÄ Modal Confirmar ‚îÄ‚îÄ */
    #m-confirmar .modal { max-width:400px; }
    .confirm-body { padding:28px; text-align:center; }
    .confirm-icon { font-size:48px; margin-bottom:14px; }
    .confirm-title { font-size:16px; font-weight:700; margin-bottom:6px; }
    .confirm-sub { font-size:13px; color:var(--gray); margin-bottom:24px; }
    .confirm-btns { display:flex; gap:10px; justify-content:center; }
    .btn-danger { padding:11px 24px; background:var(--blue); color:#fff; border:none; border-radius:9px; font-size:13.5px; font-weight:700; cursor:pointer; transition:.2s; }
    .btn-danger:hover { background:#991B1B; }
    .btn-ghost { padding:11px 20px; background:#fff; color:var(--gray); border:2px solid var(--gray-light); border-radius:9px; font-size:13px; font-weight:600; cursor:pointer; }

    /* ‚îÄ‚îÄ Admin tabs (Gesti√≥n / Estad√≠sticas) ‚îÄ‚îÄ */
    .admin-tabs {
      display:flex; border-bottom:2px solid var(--gray-light);
      background:#FAFBFF; padding:0 22px;
    }
    .admin-tab {
      padding:12px 20px; font-size:13px; font-weight:600; color:var(--gray);
      background:transparent; border:none; border-bottom:3px solid transparent;
      margin-bottom:-2px; cursor:pointer; transition:.18s;
      display:flex; align-items:center; gap:7px;
    }
    .admin-tab:hover { color:var(--blue); }
    .admin-tab.active { color:var(--blue-dark); border-bottom-color:var(--blue); }
    .admin-panel { display:none; flex:1; flex-direction:column; overflow:hidden; }
    .admin-panel.active { display:flex; }

    /* KPI cards */
    .stats-body { padding:22px; overflow-y:auto; flex:1; background:var(--bg); }
    .stats-kpi-row { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:24px; }
    .kpi-card {
      background:#fff; border-radius:12px; border:2px solid var(--gray-light);
      padding:18px 20px; display:flex; flex-direction:column; gap:4px;
    }
    .kpi-icon { font-size:22px; }
    .kpi-val  { font-size:28px; font-weight:800; color:var(--blue-dark); line-height:1.1; }
    .kpi-label { font-size:12px; color:var(--gray); font-weight:500; }

    /* Stats tables */
    .stats-section { margin-bottom:24px; }
    .stats-section-title {
      font-size:11.5px; font-weight:700; color:var(--gray);
      text-transform:uppercase; letter-spacing:1px;
      margin-bottom:10px; display:flex; align-items:center; gap:8px;
    }
    .stats-section-title::after { content:''; flex:1; height:1px; background:var(--gray-light); }
    .stats-table { width:100%; border-collapse:collapse; font-size:13px; }
    .stats-table th {
      padding:9px 14px; text-align:left; font-size:10.5px; font-weight:700;
      color:var(--gray); letter-spacing:1px; text-transform:uppercase;
      background:var(--gray-xlight); border-bottom:2px solid var(--gray-light);
    }
    .stats-table td { padding:11px 14px; border-bottom:1px solid var(--gray-light); background:#fff; vertical-align:middle; }
    .stats-table tr:hover td { background:#F8FAFF; }
    .stats-bar-wrap { width:110px; height:7px; background:var(--gray-light); border-radius:10px; overflow:hidden; display:inline-block; vertical-align:middle; margin-right:8px; }
    .stats-bar { height:100%; border-radius:10px; }
    .stats-bar.pdf { background:linear-gradient(90deg,var(--blue),#60A5FA); }
    .stats-bar.vid { background:linear-gradient(90deg,var(--blue),var(--gold)); }
    .stats-count { font-weight:700; color:var(--text); }
    .stats-rank {
      display:inline-flex; align-items:center; justify-content:center;
      width:22px; height:22px; border-radius:50%; font-size:11px; font-weight:700;
    }
    .stats-rank.r1 { background:#FEF3C7; color:#92400E; }
    .stats-rank.r2 { background:#F1F5F9; color:#475569; }
    .stats-rank.r3 { background:#FEF0E7; color:#7C2D12; }
    .stats-rank.rn { background:var(--gray-xlight); color:var(--gray); }

    /* Stats toolbar */
    .stats-toolbar {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:20px; gap:12px; flex-wrap:wrap;
    }
    .btn-export {
      display:flex; align-items:center; gap:6px; padding:8px 16px; border-radius:8px;
      background:var(--blue-xlight); color:var(--blue); border:1.5px solid var(--blue-light);
      font-size:12.5px; font-weight:700; cursor:pointer; transition:.18s;
    }
    .btn-export:hover { background:var(--blue-light); }
    .btn-clear-stats {
      padding:6px 14px; border-radius:8px; font-size:12px; font-weight:600;
      background:#FEF2F2; color:#B03020; border:1.5px solid #FBBFBA; cursor:pointer;
    }
    .btn-clear-stats:hover { background:#FEE2E2; }
    .period-pill {
      padding:5px 13px; border-radius:100px; font-size:12px; font-weight:600;
      border:1.5px solid var(--gray-light); background:#fff; color:var(--gray);
      cursor:pointer; transition:.15s; font-family:'Poppins',sans-serif;
    }
    .period-pill:hover { border-color:var(--blue); color:var(--blue); }
    .period-pill.active { background:var(--blue); color:#fff; border-color:var(--blue); }

    /* ‚îÄ‚îÄ Bot√≥n flotante ‚îÄ‚îÄ */
    .float-wrap {
      position:fixed; bottom:32px; right:28px; z-index:600;
      display:flex; flex-direction:column; align-items:flex-end; gap:10px;
    }
    .float-popup {
      background:#fff; border-radius:14px; min-width:240px; overflow:hidden;
      box-shadow:var(--shadow-lg); border:2px solid var(--gray-light);
      display:none; animation:mUp .2s ease;
    }
    .float-popup.show { display:block; }
    .fp-head { background:linear-gradient(120deg,var(--blue-dark),var(--blue)); color:#fff; padding:13px 16px; font-size:13px; font-weight:700; }
    .fp-opt { display:flex; align-items:center; gap:12px; padding:13px 16px; cursor:pointer; border-bottom:1px solid var(--gray-light); transition:.15s; }
    .fp-opt:last-of-type { border-bottom:none; }
    .fp-opt:hover { background:var(--blue-xlight); }
    .fp-ico { width:36px; height:36px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0; }
    .fp-ico.m { background:var(--blue-light); }
    .fp-ico.v { background:#FEF3C7; }
    .fp-txt strong { font-size:13px; color:var(--blue-dark); display:block; font-weight:600; }
    .fp-txt span { font-size:11px; color:var(--gray); }
    .fp-close { padding:9px 16px; border-top:1px solid var(--gray-light); display:flex; justify-content:flex-end; }
    .fp-close-btn { background:none; border:none; font-size:12px; color:var(--gray); font-weight:600; cursor:pointer; }
    .float-row { display:flex; align-items:center; gap:10px; }
    .float-label {
      background:var(--blue-dark); color:#fff; font-size:11px; font-weight:700;
      padding:5px 13px; border-radius:100px; white-space:nowrap;
      outline:2.5px solid rgba(255,255,255,.3); box-shadow:0 4px 14px rgba(0,0,0,.14);
    }
    .float-btn {
      width:56px; height:56px; border-radius:50%; border:none;
      background:linear-gradient(135deg,#C9735F,#A5564A); color:#fff; font-size:24px;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 0 0 3px rgba(255,255,255,.85), 0 8px 24px rgba(0,0,0,.16);
      transition:.25s; position:relative;
    }
    .float-btn:hover { transform:scale(1.08); }
    .float-ripple {
      position:absolute; inset:-5px; border-radius:50%;
      border:2px solid rgba(192,57,43,.20);
      animation:ripple 2s infinite;
    }
    @keyframes ripple { from{transform:scale(1);opacity:.8} to{transform:scale(1.6);opacity:0} }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    footer {
      background:#7D3E30; color:rgba(255,255,255,.65);
      padding:28px 28px 90px; margin-top:0;
    }
    .footer-inner {
      max-width:1280px; margin:auto;
      display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
    }
    .footer-brand strong { color:#fff; font-size:13.5px; font-weight:700; display:block; }
    .footer-brand span { font-size:12px; }
    .footer-bottom {
      max-width:1280px; margin:16px auto 0; padding-top:14px;
      border-top:1px solid rgba(255,255,255,.1);
      display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px;
    }
    .footer-bottom span { font-size:11px; opacity:.4; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media(max-width:900px) {
      .content-wrap { flex-direction:column; }
      .sidebar { width:100%; position:static; }
      .hero-stats { display:none; }
      .hero-text h1 { font-size:24px; }
    }
    @media(max-width:640px) {
      .header-inner { padding:0 16px; height:58px; }
      .brand-texts span { display:none; }
      .hero { padding:36px 18px 40px; }
      .search-bar, .tabs-wrap, .content-wrap { padding-left:16px; padding-right:16px; }
      .tabs { gap:4px; }
      .tab { padding:9px 14px; font-size:12.5px; }
      .float-wrap { bottom:20px; right:16px; }
      .float-label { display:none; }
      .float-btn { width:50px; height:50px; font-size:22px; }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       M√ìDULOS INTERNOS ‚Äî Paz y Salvo ¬∑ Factura
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .mod-header {
      background:#fff; border-bottom:3px solid var(--red);
      height:60px; display:flex; align-items:center;
      justify-content:space-between; padding:0 28px;
      position:sticky; top:0; z-index:200;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .mod-home-ico { width:42px; height:42px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .mod-header-center { display:flex; align-items:center; gap:10px; }
    .mod-escudo {
      width:44px; height:44px;
      background:linear-gradient(135deg,#003F87,#1565C0,#FFD700);
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-size:22px; border:2px solid #ccc; box-shadow:0 2px 6px rgba(0,0,0,.15);
    }
    .mod-alcaldia strong { display:block; font-size:14px; font-weight:700; color:var(--text); }
    .mod-alcaldia span   { font-size:12px; color:var(--gray); }
    .mod-btn-acceder {
      display:flex; align-items:center; gap:7px; background:var(--red); color:#fff;
      padding:9px 20px; border-radius:6px; font-size:13.5px; font-weight:600;
      border:none; cursor:pointer; font-family:'Poppins',sans-serif; transition:.2s;
    }
    .mod-btn-acceder:hover { background:var(--red-dark); }
    .mod-body {
      min-height:calc(100vh - 60px - 128px);
      padding:56px 40px 80px; background:#fff;
      display:flex; flex-direction:column; align-items:center;
    }
    .mod-title {
      font-size:clamp(22px,3vw,36px); font-weight:700; color:var(--red);
      text-align:center; margin-bottom:22px; line-height:1.2;
    }
    /* Paz y Salvo */
    .paz-desc { max-width:820px; text-align:center; font-size:14.5px; color:var(--gray); line-height:1.8; margin-bottom:44px; }
    .paz-form { width:100%; max-width:680px; }
    .paz-row { display:grid; grid-template-columns:220px 1fr; align-items:center; gap:20px; margin-bottom:20px; }
    .paz-label { font-size:14.5px; color:var(--text); text-align:right; }
    .paz-input { padding:11px 14px; border:1px solid #bbb; border-radius:4px; font-family:'Poppins',sans-serif; font-size:14px; outline:none; transition:.18s; width:100%; }
    .paz-input:focus { border-color:var(--red); box-shadow:0 0 0 3px rgba(192,57,43,.12); }
    .paz-btns { display:grid; grid-template-columns:1fr 1fr; margin-top:8px; }
    .paz-btn-nueva { padding:16px; background:#6B8090; color:#fff; border:none; font-family:'Poppins',sans-serif; font-size:15px; font-weight:500; cursor:pointer; transition:.18s; }
    .paz-btn-nueva:hover { background:#546472; }
    .paz-btn-validar { padding:16px; background:var(--red); color:#fff; border:none; font-family:'Poppins',sans-serif; font-size:15px; font-weight:500; cursor:pointer; transition:.18s; }
    .paz-btn-validar:hover { background:var(--red-dark); }
    .paz-resultado { display:none; width:100%; max-width:680px; margin-top:28px; border-radius:10px; padding:26px 30px; border:2px solid; animation:modFadeIn .3s ease; }
    .paz-resultado.ok  { background:#F0FDF4; border-color:#86EFAC; color:#166534; }
    .paz-resultado.err { background:#FEF2F2; border-color:#FCA5A5; color:#991B1B; }
    .paz-resultado.show { display:block; }
    .paz-res-icon { font-size:38px; margin-bottom:10px; }
    .paz-res-title { font-size:17px; font-weight:700; margin-bottom:6px; }
    .paz-res-detail { font-size:13.5px; line-height:1.75; }
    /* Factura */
    .fac-desc-box { width:100%; max-width:980px; border:1px solid #ccc; border-radius:4px; padding:18px 24px; margin-bottom:48px; font-size:14px; color:#333; line-height:1.75; background:#fafafa; }
    .fac-form { width:100%; max-width:520px; display:flex; flex-direction:column; align-items:center; }
    .fac-select-label { font-size:14.5px; font-weight:700; color:var(--text); text-align:center; margin-bottom:10px; }
    .fac-select-label .req { color:var(--red); }
    .fac-select { width:100%; padding:13px 16px; border:1px solid #bbb; border-radius:4px; font-family:'Poppins',sans-serif; font-size:14px; color:var(--text); background:#fff; cursor:pointer; outline:none; transition:.18s; -webkit-appearance:none; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23666' stroke-width='1.8' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 14px center; }
    .fac-select:focus { border-color:var(--red); }
    .fac-fields { display:none; width:100%; margin-top:28px; }
    .fac-fields.show { display:block; animation:modFadeIn .3s ease; }
    .fac-fields-title { font-size:13.5px; color:var(--gray); text-align:center; margin-bottom:20px; border-top:1px solid #eee; padding-top:20px; }
    .fac-field-group { margin-bottom:16px; }
    .fac-field-label { font-size:12.5px; font-weight:600; color:var(--gray); margin-bottom:6px; display:block; }
    .fac-field-input { width:100%; padding:11px 14px; border:1px solid #bbb; border-radius:4px; font-family:'Poppins',sans-serif; font-size:14px; outline:none; transition:.18s; }
    .fac-field-input:focus { border-color:var(--red); box-shadow:0 0 0 3px rgba(192,57,43,.12); }
    .fac-btn-consultar { width:100%; padding:15px; background:var(--red); color:#fff; border:none; border-radius:4px; font-family:'Poppins',sans-serif; font-size:15px; font-weight:600; cursor:pointer; transition:.2s; margin-top:8px; }
    .fac-btn-consultar:hover { background:var(--red-dark); }
    .fac-btn-limpiar { width:100%; padding:12px; background:#6B8090; color:#fff; border:none; border-radius:4px; font-family:'Poppins',sans-serif; font-size:14px; font-weight:500; cursor:pointer; transition:.2s; margin-top:8px; }
    .fac-btn-limpiar:hover { background:#546472; }
    /* Footer m√≥dulo */
    .mod-footer { background:var(--red); color:rgba(255,255,255,.85); padding:32px 40px; text-align:center; }
    .mod-footer-logo { font-size:26px; font-weight:900; color:#fff; margin-bottom:6px; display:flex; align-items:center; justify-content:center; gap:4px; letter-spacing:-1px; }
    .mod-footer-logo .logo-m { color:rgba(255,255,255,.5); }
    .mod-footer p { font-size:12.5px; opacity:.8; margin-top:4px; }
    .mod-footer-version { font-size:11px; opacity:.5; margin-top:3px; }

    @keyframes modFadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }

    /* ‚ïê‚ïê BOT√ìN "AYUDAS PR√ÅCTICAS" ‚Äî solo m√≥dulos internos ‚ïê‚ïê */
    .mod-ayudas-wrap {
      position:fixed; bottom:28px; right:28px; z-index:600;
      display:flex; flex-direction:column; align-items:flex-end; gap:10px;
    }
    .mod-ayudas-popup {
      background:#fff; border-radius:14px; min-width:248px; overflow:hidden;
      box-shadow:0 8px 32px rgba(0,0,0,.18); border:1.5px solid #E0E0E0;
      display:none; animation:modFadeIn .2s ease;
    }
    .mod-ayudas-popup.show { display:block; }
    .map-head {
      background:linear-gradient(120deg,var(--blue-dark),var(--blue));
      color:#fff; padding:13px 16px; font-size:13px; font-weight:700;
    }
    .map-opt {
      display:flex; align-items:center; gap:12px; padding:13px 16px;
      cursor:pointer; border-bottom:1px solid #EEF0F5; transition:.15s;
    }
    .map-opt:last-of-type { border-bottom:none; }
    .map-opt:hover { background:#FFF5F5; }
    .map-ico {
      width:34px; height:34px; border-radius:9px;
      display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0;
    }
    .map-ico.m { background:#FDEAEA; }
    .map-ico.v { background:#FEE2E2; }
    .map-txt strong { display:block; font-size:13px; font-weight:600; color:#1C2B4A; }
    .map-txt span   { font-size:11px; color:#6B7A99; }
    .map-close { padding:9px 16px; border-top:1px solid #EEF0F5; display:flex; justify-content:flex-end; }
    .map-close-btn { background:none; border:none; font-size:12px; color:#6B7A99; font-weight:600; cursor:pointer; font-family:'Poppins',sans-serif; }
    .map-row { display:flex; align-items:center; gap:10px; }
    .map-label {
      background:var(--blue-dark); color:#fff; font-size:12px; font-weight:700;
      padding:7px 16px; border-radius:100px;
      box-shadow:0 3px 12px rgba(0,0,0,.14);
      outline:3px solid rgba(255,255,255,.9);
    }
    .map-btn {
      width:52px; height:52px; border-radius:50%;
      background:linear-gradient(135deg,var(--red),var(--orange));
      color:#fff; font-size:22px; border:none; cursor:pointer;
      box-shadow:0 0 0 3px rgba(255,255,255,.9), 0 6px 20px rgba(0,0,0,.18);
      display:flex; align-items:center; justify-content:center;
      font-family:'Poppins',sans-serif; transition:.2s;
    }
    .map-btn:hover { transform:scale(1.07); box-shadow:0 0 0 3px rgba(255,255,255,.9), 0 8px 26px rgba(0,0,0,.20); }

  </style>
</head>
<body>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VISTA 1: PORTAL TRIBUTARIO BASE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="vista activa" id="vista-portal">

  <!-- Header -->
  <header class="pb-header">
    <div class="pb-home-ico">
      <svg class="pb-icon-home" viewBox="0 0 24 24" fill="none">
        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9 21 9 15 12 15C15 15 15 21 15 21M9 21H15"
              stroke="#CC1F1F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="pb-header-center">
      <div class="pb-escudo">üèõÔ∏è</div>
      <div class="pb-alcaldia-text">
        <strong>Alcald√≠a</strong><span>de Colombia</span>
      </div>
    </div>
    <button class="pb-btn-acceder">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
        <path d="M15 3H19C19.5523 3 20 3.44772 20 4V20C20 20.5523 19.5523 21 19 21H15M10 17L15 12M15 12L10 7M15 12H3"
              stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Acceder
    </button>
  </header>

  <!-- Carousel -->
  <div class="pb-carousel">
    <div class="pb-carousel-slide">
      <div class="pb-brand">
        <div><div class="pb-brand-title">PORTAL<br>TRIBUTARIO</div></div>
        <div class="pb-carousel-escudo">üèõÔ∏è</div>
        <div class="pb-carousel-alcaldia">
          <strong>Alcald√≠a</strong><span>de Colombia</span>
        </div>
      </div>
    </div>
    <div class="pb-carousel-stripe"></div>
    <button class="pb-nav prev">‚Äπ</button>
    <button class="pb-nav next">‚Ä∫</button>
    <div class="pb-dots">
      <div class="pb-dot"></div>
      <div class="pb-dot active"></div>
      <div class="pb-dot"></div>
    </div>
  </div>

  <!-- Banner ¬øC√≥mo usar el portal? -->
  <div class="pb-banner" onclick="irACentroAyudaDesdePortal()">
    <div class="pb-banner-left">
      <div class="pb-play-ico">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
          <path d="M12 6.25278V19.2528M12 6.25278C10.8321 5.47686 9.24649 5 7.5 5C5.75351 5 4.16789 5.47686 3 6.25278V19.2528C4.16789 18.4769 5.75351 18 7.5 18C9.24649 18 10.8321 18.4769 12 19.2528M12 6.25278C13.1679 5.47686 14.7535 5 16.5 5C18.2465 5 19.8321 5.47686 21 6.25278V19.2528C19.8321 18.4769 18.2465 18 16.5 18C14.7535 18 13.1679 18.4769 12 19.2528" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="pb-banner-text">
        <h3>¬øC√≥mo usar el portal tributario?</h3>
        <p>Manuales de usuario y videos tutoriales para cada servicio.</p>
      </div>
    </div>
    <button class="pb-btn-videos" onclick="event.stopPropagation(); irACentroAyudaDesdePortal()">
      <svg viewBox="0 0 24 24" width="14" height="14"><path d="M12 6.25278V19.2528M12 6.25278C10.8321 5.47686 9.24649 5 7.5 5C5.75351 5 4.16789 5.47686 3 6.25278V19.2528C4.16789 18.4769 5.75351 18 7.5 18C9.24649 18 10.8321 18.4769 12 19.2528M12 6.25278C13.1679 5.47686 14.7535 5 16.5 5C18.2465 5 19.8321 5.47686 21 6.25278V19.2528C19.8321 18.4769 18.2465 18 16.5 18C14.7535 18 13.1679 18.4769 12 19.2528" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
      Centro de Ayuda
    </button>
  </div>

  <!-- Nuestros servicios -->
  <section class="pb-servicios">
    <h2 class="pb-servicios-title">Nuestros servicios</h2>
    <div class="pb-grid">
      <div class="pb-card"><div class="pb-card-bg bg-1"></div><div class="pb-card-label">Diligenciar Declaraciones</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-2"></div><div class="pb-card-label">Informaci√≥n tributaria</div></div>
      <div class="pb-card" onclick="irAFactura()" style="cursor:pointer;"><div class="pb-card-bg bg-3"></div><div class="pb-card-label">Consulte, descargue y pague su factura</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-4"></div><div class="pb-card-label">Registre un nuevo usuario</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-5"></div><div class="pb-card-label">Cargue Informaci√≥n Ex√≥gena</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-6"></div><div class="pb-card-label">Emisi√≥n Paz y Salvo Gratuito</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-7"></div><div class="pb-card-label">Formulario Inscripci√≥n RITI</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-8"></div><div class="pb-card-label">Firmar Declaraciones (Suscripci√≥n Acuerdo)</div></div>
      <div class="pb-card" onclick="irAPazSalvo()" style="cursor:pointer;"><div class="pb-card-bg bg-9"></div><div class="pb-card-label">Validaci√≥n Paz y Salvo</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-10"></div><div class="pb-card-label">Informaci√≥n Ex√≥gena Temporal</div></div>
      <div class="pb-card"><div class="pb-card-bg bg-11"></div><div class="pb-card-label">Factura Presta M√©rito Ejecutivo</div></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="pb-footer">
    <div class="pb-footer-logo">sm<span class="logo-m">‚óÜ</span>rt</div>
    <p>Todos los derechos reservados ¬© SMART TMT 2026</p>
    <p class="pb-footer-version">ReleaseV.4.1.8</p>
  </footer>

  <!-- Flotante naranja -->

</div><!-- /vista-portal -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VISTA 2: CENTRO DE AYUDA TRIBUTARIA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="vista" id="vista-ayuda">

  <!-- Barra de regreso al portal base -->
  <div class="back-bar">
    <button class="back-bar-btn" onclick="volverAlPortal()">
      ‚Üê Volver al Portal Tributario
    </button>
    <span class="back-bar-sep">|</span>
    <span>üè† Portal Tributario ‚Ä∫ Centro de Ayuda</span>
  </div>



<!-- Centro de ayuda contenido -->
<!-- ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ -->
<div id="loader">
  <div class="loader-logo">üèõÔ∏è</div>
  <div class="loader-bar-wrap"><div class="loader-bar"></div></div>
  <div class="loader-text">Cargando Centro de Ayuda...</div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HEADER ‚Äî Barra superior fija con identidad del portal
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header class="header">
  <div class="header-inner">
    <div class="brand">
      <div class="brand-logo">üèõÔ∏è</div>
      <div class="brand-texts">
        <strong>Centro de Ayuda Tributaria</strong>
        <span>Portal Tributario ¬∑ Gesti√≥n Municipal</span>
      </div>
    </div>
    <div class="header-right">
      <!-- Bot√≥n de acceso al m√≥dulo de administraci√≥n -->
      <button class="btn-admin" onclick="openModal('m-login')">‚öôÔ∏è Administrar</button>
    </div>
  </div>
</header>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HERO ‚Äî Banner principal con descripci√≥n y estad√≠sticas
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="hero">
  <div class="hero-pattern"></div>
  <div class="hero-circle-1"></div>
  <div class="hero-circle-2"></div>
  <div class="hero-inner">
    <div class="hero-text">
      <!-- Ruta de navegaci√≥n contextual -->
      <div class="hero-breadcrumb">
        üè† Portal Tributario <span>‚Ä∫</span> Centro de Ayuda
      </div>
      <h1>¬øC√≥mo podemos<br><em>ayudarte hoy?</em></h1>
      <p>Encuentra manuales de usuario y videos tutoriales organizados por m√≥dulo para cada servicio del portal tributario.</p>
    </div>
    <!-- Estad√≠sticas del portal -->
    <div class="hero-stats">
      <div class="hero-stat">
        <div class="hero-stat-n" id="stat-manuales">16</div>
        <div class="hero-stat-l">Manuales</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-n">6</div>
        <div class="hero-stat-l">M√≥dulos</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-n" id="stat-videos">16</div>
        <div class="hero-stat-l">Videos</div>
      </div>
    </div>
  </div>
</section>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BUSCADOR PRINCIPAL ‚Äî Flota sobre el hero
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="search-bar">
  <div class="search-inner">
    <span class="search-icon">üîç</span>
    <input type="text" id="global-search"
           placeholder="Buscar manuales, temas, m√≥dulos..."
           oninput="buscarGlobal(this.value)">
    <button class="search-clear" id="search-clear" onclick="limpiarBusqueda()">‚úï</button>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TABS ‚Äî Alternar entre Manuales y Videos
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tabs-wrap">
  <div class="tabs">
    <button class="tab active" id="tab-manuales" onclick="cambiarTab('manuales')">
      üìÑ Manuales de Usuario <span class="tab-count" id="tc-manuales">16</span>
    </button>
    <button class="tab" id="tab-videos" onclick="cambiarTab('videos')">
      ‚ñ∂Ô∏è Videos Tutoriales <span class="tab-count" id="tc-videos">16</span>
    </button>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CONTENIDO PRINCIPAL ‚Äî Sidebar + √Årea de tarjetas
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="content-wrap">

  <!-- Sidebar de navegaci√≥n por secci√≥n -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-title">M√≥dulos</div>
    <!-- Los items del sidebar se generan din√°micamente -->
  </aside>

  <!-- √Årea principal con tarjetas por secci√≥n -->
  <main class="main-area">
    <!-- Estado vac√≠o cuando la b√∫squeda no tiene resultados -->
    <div class="empty-state" id="empty-state">
      <div class="empty-state-icon">üîç</div>
      <p>No se encontraron resultados para tu b√∫squeda.</p>
    </div>
    <!-- Las secciones se generan din√°micamente por JavaScript -->
  </main>

</div><!-- fin content-wrap -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FOOTER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer>
  <div class="footer-inner">
    <div class="footer-brand">
      <strong>Centro de Ayuda Tributaria</strong>
      <span>Portal de recursos, manuales y videos tutoriales tributarios</span>
    </div>
  </div>
  <div class="footer-bottom">
    <span>¬© 2026 Centro de Ayuda en la Gesti√≥n Tributaria. Todos los derechos reservados.</span>
    <span>RELEASE V.5.4.0 ‚Äî Smart TMT</span>
  </div>
</footer>





<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: VISOR DE PDF
     Renderizado con PDF.js ‚Äî sin descarga ni impresi√≥n.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-pdf">
  <div class="modal" style="max-width:900px;max-height:92vh;display:flex;flex-direction:column;">
    <div class="pdf-head">
      <strong id="pdf-title">Manual de Usuario</strong>
      <div class="pdf-actions">
        <button class="pdf-action-btn" onclick="closePDF()">‚úï Cerrar</button>
      </div>
    </div>
    <!-- Canvas pages rendered here -->
    <div class="pdf-body" id="pdf-body"
         oncontextmenu="return false;">
      <div class="pdf-placeholder">
        <div class="big-icon">üìÑ</div>
        <p>Vista previa del manual</p>
        <small>El documento se mostrar√° aqu√≠ cuando est√© disponible.</small>
      </div>
    </div>
    <!-- Barra de navegaci√≥n de p√°ginas -->
    <div class="pdf-nav" id="pdf-nav" style="display:none;">
      <button id="pdf-prev" onclick="pdfCambiarPagina(-1)" title="P√°gina anterior">‚Äπ</button>
      <span id="pdf-page-info">P√°gina 1 de 1</span>
      <button id="pdf-next" onclick="pdfCambiarPagina(1)"  title="P√°gina siguiente">‚Ä∫</button>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: VIDEO TUTORIAL
     Muestra el enlace del video y abre YouTube.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-video">
  <div class="modal" style="max-width:760px;max-height:92vh;">
    <div class="modal-head">
      <div class="mh-left">
        <div class="mh-ico">‚ñ∂Ô∏è</div>
        <div>
          <div class="mh-title" id="video-title">Video Tutorial</div>
          <div class="mh-sub" id="video-sub">Tutorial del servicio</div>
        </div>
      </div>
      <button class="btn-mclose" onclick="closeAll()">‚úï</button>
    </div>

    <!-- ‚îÄ‚îÄ Reproductor con thumbnail ‚Üí iframe al hacer clic ‚îÄ‚îÄ -->
    <div id="video-player-wrap" style="display:none;">

      <!-- ESTADO A: Thumbnail (visible antes de presionar play) -->
      <div id="video-thumb-wrap"
           style="position:relative;width:100%;aspect-ratio:16/9;
                  background:#000;overflow:hidden;cursor:pointer;"
           onclick="iniciarReproduccion()"
           onmouseover="document.getElementById('vplay-btn').style.transform='scale(1.12)'"
           onmouseout="document.getElementById('vplay-btn').style.transform='scale(1)'">
        <img id="video-thumb-img" src="" alt="miniatura"
             style="width:100%;height:100%;object-fit:cover;display:block;">
        <!-- Overlay oscuro -->
        <div style="position:absolute;inset:0;background:rgba(0,0,0,.28);"></div>
        <!-- Bot√≥n play -->
        <div id="vplay-btn"
             style="position:absolute;inset:0;display:flex;align-items:center;
                    justify-content:center;transition:transform .18s;">
          <div style="width:76px;height:76px;border-radius:50%;
                      background:rgba(180,90,70,.88);
                      display:flex;align-items:center;justify-content:center;
                      box-shadow:0 6px 28px rgba(0,0,0,.55);">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
              <polygon points="7,3 21,12 7,21"/>
            </svg>
          </div>
        </div>
        <!-- Etiqueta -->
        <div style="position:absolute;bottom:12px;left:14px;
                    background:rgba(0,0,0,.72);border-radius:6px;
                    padding:4px 10px;font-size:11.5px;color:#fff;font-weight:600;">
          ‚ñ∂ Clic para reproducir
        </div>
      </div>

      <!-- ESTADO B: iframe YouTube (inyectado por JS al hacer clic en play) -->
      <div id="video-yt-container"
           style="display:none;width:100%;aspect-ratio:16/9;background:#000;"></div>

      <!-- Pie -->
      <div style="padding:13px 20px;display:flex;align-items:center;
                  justify-content:space-between;gap:12px;background:#fff;
                  border-top:1.5px solid var(--gray-light);">
        <span style="font-size:13px;font-weight:700;color:var(--text);flex:1;
                     white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"
              id="video-footer-name">‚Äî</span>
        <a id="video-yt-ext" href="#" target="_blank" rel="noopener"
           style="font-size:12px;font-weight:600;color:var(--gray);text-decoration:none;
                  white-space:nowrap;padding:6px 12px;border:1.5px solid var(--gray-light);
                  border-radius:7px;display:flex;align-items:center;gap:5px;">
          ‚Üó Abrir en YouTube
        </a>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Sin URL disponible ‚îÄ‚îÄ -->
    <div id="video-no-url"
         style="display:none;padding:56px 28px;text-align:center;
                flex-direction:column;align-items:center;gap:14px;background:var(--bg);">
      <span style="font-size:52px;">‚è≥</span>
      <div style="font-size:16px;font-weight:700;color:var(--text);">Video pr√≥ximamente</div>
      <div style="font-size:13px;color:var(--gray);">Este video tutorial a√∫n no est√° disponible.</div>
    </div>

  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: INICIO DE SESI√ìN ADMINISTRACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-login">
  <div class="modal" style="max-width:400px;">
    <div class="modal-head">
      <div class="mh-left">
        <div class="mh-ico">üîê</div>
        <div>
          <div class="mh-title">Administraci√≥n</div>
          <div class="mh-sub">Ingresa tus credenciales</div>
        </div>
      </div>
      <button class="btn-mclose" onclick="closeAll()">‚úï</button>
    </div>
    <div class="login-body">
      <div class="alert-error" id="login-error">‚ùå Usuario o contrase√±a incorrectos.</div>
      <div class="form-group">
        <label class="form-label">Usuario</label>
        <input class="form-input" id="login-user" type="text" placeholder="Ingresa tu usuario"
               onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <div class="form-group" style="margin-bottom:22px;">
        <label class="form-label">Contrase√±a</label>
        <input class="form-input" id="login-pass" type="password" placeholder="Ingresa tu contrase√±a"
               onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="btn-primary" onclick="doLogin()">üîê Ingresar</button>
      <p class="login-note">Credenciales de prueba: <strong>12345</strong> / <strong>12345</strong></p>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: PANEL DE ADMINISTRACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-admin">
  <div class="modal" style="max-width:960px;max-height:90vh;">

    <!-- Header del panel -->
    <div class="modal-head">
      <div class="mh-left">
        <div class="mh-ico">‚öôÔ∏è</div>
        <div>
          <div class="mh-title">Panel de Administraci√≥n</div>
          <div class="mh-sub">Gesti√≥n de manuales y videos</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button onclick="cerrarSesion()"
                style="padding:6px 13px;background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);
                border-radius:7px;color:#fff;font-size:12px;font-weight:600;cursor:pointer;">
          üö™ Cerrar sesi√≥n
        </button>
        <button class="btn-mclose" onclick="closeAll()">‚úï</button>
      </div>
    </div>

    <!-- Tabs de navegaci√≥n interna -->
    <div class="admin-tabs">
      <button class="admin-tab active" id="atab-gestion" onclick="switchAdminTab('gestion')">
        üìã Gesti√≥n de Contenido
      </button>
      <button class="admin-tab" id="atab-stats" onclick="switchAdminTab('stats')">
        üìä Estad√≠sticas de Uso
      </button>
    </div>

    <!-- ‚îÄ‚îÄ Panel: GESTI√ìN ‚îÄ‚îÄ -->
    <div class="admin-panel active" id="apanel-gestion">
      <div class="admin-toolbar">
        <div style="display:flex;gap:8px;">
          <button class="btn-add" onclick="abrirFormularioTipo('manuales')">‚ûï Agregar Manual</button>
          <button class="btn-add" onclick="abrirFormularioTipo('videos')"
                  style="background:var(--blue-mid);">‚ûï Agregar Video</button>
        </div>
        <div class="admin-search">
          <input type="text" placeholder="Buscar..." oninput="filtrarAdmin(this.value)">
        </div>
      </div>
      <div class="admin-body">
        <table class="admin-table">
          <thead>
            <tr>
              <th class="col-ico">Ico</th>
              <th class="col-sec">Secci√≥n</th>
              <th class="col-name">Nombre</th>
              <th class="col-ver">Versi√≥n</th>
              <th class="col-date">Actualizado</th>
              <th class="col-st">Estado</th>
              <th class="col-act">Acciones</th>
            </tr>
          </thead>
          <tbody id="admin-tbody"></tbody>
        </table>
      </div>
      <div class="admin-foot">
        <span id="admin-count">‚Äî</span>
        <span style="font-size:11px;opacity:.6;">Los cambios se aplican en tiempo real al portal</span>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Panel: ESTAD√çSTICAS ‚îÄ‚îÄ -->
    <div class="admin-panel" id="apanel-stats">
      <div class="stats-body">

        <!-- Toolbar: filtro de fecha + exportar -->
        <div class="stats-toolbar">
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <span style="font-size:12px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.8px;">Per√≠odo:</span>
            <div style="display:flex;gap:6px;" id="period-pills">
              <button class="period-pill active" onclick="setPeriod('today',this)">Hoy</button>
              <button class="period-pill" onclick="setPeriod('week',this)">Esta semana</button>
              <button class="period-pill" onclick="setPeriod('month',this)">Este mes</button>
              <button class="period-pill" onclick="setPeriod('all',this)">Todo</button>
            </div>
            <!-- Rango personalizado -->
            <div style="display:flex;align-items:center;gap:6px;">
              <input type="date" id="date-from"
                     style="padding:5px 10px;border:1.5px solid var(--gray-light);border-radius:7px;
                     font-family:'Poppins',sans-serif;font-size:12px;outline:none;color:var(--text);">
              <span style="font-size:12px;color:var(--gray);">‚Äî</span>
              <input type="date" id="date-to"
                     style="padding:5px 10px;border:1.5px solid var(--gray-light);border-radius:7px;
                     font-family:'Poppins',sans-serif;font-size:12px;outline:none;color:var(--text);">
              <button onclick="setPeriod('custom',null)"
                      style="padding:5px 12px;border-radius:7px;background:var(--blue);color:#fff;
                      border:none;font-size:12px;font-weight:600;cursor:pointer;font-family:'Poppins',sans-serif;">
                Aplicar
              </button>
            </div>
          </div>
          <button class="btn-export" onclick="exportarExcel()">‚¨áÔ∏è Exportar Excel</button>
        </div>

        <!-- Nota de per√≠odo activo -->
        <div id="stats-period-note"
             style="font-size:12px;color:var(--blue);background:var(--blue-xlight);
             border:1.5px solid var(--blue-light);border-radius:8px;padding:7px 14px;
             margin-bottom:18px;display:inline-block;font-weight:500;">
        </div>

        <!-- KPIs -->
        <div class="stats-kpi-row" id="stats-kpis"></div>

        <!-- Gr√°ficas de torta + tablas lado a lado -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px;">

          <!-- Torta Manuales -->
          <div style="background:#fff;border-radius:12px;border:2px solid var(--gray-light);padding:20px;">
            <div class="stats-section-title" style="margin-bottom:16px;">üìÑ Distribuci√≥n de manuales</div>
            <div style="display:flex;align-items:center;gap:20px;">
              <canvas id="chart-pdf" width="160" height="160" style="flex-shrink:0;"></canvas>
              <div id="legend-pdf" style="flex:1;font-size:11.5px;display:flex;flex-direction:column;gap:5px;"></div>
            </div>
          </div>

          <!-- Torta Videos -->
          <div style="background:#fff;border-radius:12px;border:2px solid var(--gray-light);padding:20px;">
            <div class="stats-section-title" style="margin-bottom:16px;">‚ñ∂Ô∏è Distribuci√≥n de videos</div>
            <div style="display:flex;align-items:center;gap:20px;">
              <canvas id="chart-vid" width="160" height="160" style="flex-shrink:0;"></canvas>
              <div id="legend-vid" style="flex:1;font-size:11.5px;display:flex;flex-direction:column;gap:5px;"></div>
            </div>
          </div>

        </div>

        <!-- Tabla manuales -->
        <div class="stats-section">
          <div class="stats-section-title">üìÑ Manuales m√°s consultados</div>
          <table class="stats-table">
            <thead>
              <tr>
                <th style="width:36px;">#</th>
                <th>Manual</th>
                <th style="width:130px;">Secci√≥n</th>
                <th style="width:200px;">Veces abierto</th>
                <th style="width:90px;text-align:right;">%</th>
              </tr>
            </thead>
            <tbody id="stats-tbody-pdf"></tbody>
          </table>
        </div>

        <!-- Tabla videos -->
        <div class="stats-section">
          <div class="stats-section-title">‚ñ∂Ô∏è Videos m√°s consultados</div>
          <table class="stats-table">
            <thead>
              <tr>
                <th style="width:36px;">#</th>
                <th>Video</th>
                <th style="width:130px;">Secci√≥n</th>
                <th style="width:200px;">Veces abierto</th>
                <th style="width:90px;text-align:right;">%</th>
              </tr>
            </thead>
            <tbody id="stats-tbody-vid"></tbody>
          </table>
        </div>

      </div>
    </div>

  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: FORMULARIO AGREGAR / EDITAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-form">
  <div class="modal" style="max-width:520px;max-height:92vh;">
    <div class="modal-head">
      <div class="mh-left">
        <div class="mh-ico" id="form-ico-display">üìÑ</div>
        <div>
          <div class="mh-title" id="form-modal-title">Agregar Manual</div>
          <div class="mh-sub">Completa todos los campos</div>
        </div>
      </div>
      <button class="btn-mclose" onclick="volverAlAdmin()">‚úï</button>
    </div>
    <div class="form-body">
      <!-- Selector de √≠cono -->
      <div class="form-group">
        <label class="form-label">√çcono</label>
        <div class="icon-picker" id="icon-picker"></div>
        <input type="hidden" id="form-icono" value="üìÑ">
      </div>

      <!-- Secci√≥n (categor√≠a padre) -->
      <div class="form-group">
        <label class="form-label">Secci√≥n</label>
        <select class="form-input" id="form-seccion">
          <option value="">‚Äî Selecciona una secci√≥n ‚Äî</option>
        </select>
      </div>

      <!-- Subsecci√≥n (n√∫mero como 1.1, 1.2‚Ä¶) -->
      <div class="form-group">
        <label class="form-label">N√∫mero de √≠tem <span style="color:var(--gray);font-weight:300;">(ej: 1.1, 2.3)</span></label>
        <input class="form-input" id="form-num" type="text" placeholder="Ej: 1.1">
      </div>

      <!-- Nombre -->
      <div class="form-group">
        <label class="form-label">Nombre del manual / video</label>
        <input class="form-input" id="form-nombre" type="text" placeholder="Ej: Inicio de sesi√≥n contribuyente">
      </div>

      <!-- Versi√≥n -->
      <div class="form-group">
        <label class="form-label">Versi√≥n</label>
        <input class="form-input" id="form-version" type="text" placeholder="Ej: 1.0">
      </div>

      <!-- Fecha -->
      <div class="form-group">
        <label class="form-label">Fecha de actualizaci√≥n</label>
        <input class="form-input" id="form-fecha" type="date">
      </div>

      <!-- Pesta√±as PDF / Video dentro del formulario -->
      <div class="form-group" id="group-contenido">
        <label class="form-label">Contenido del √≠tem</label>
        <div style="display:flex;gap:0;border:2px solid var(--gray-light);border-radius:10px;overflow:hidden;margin-bottom:14px;">
          <button type="button" id="ftab-pdf" onclick="formTabContenido('pdf')"
                  style="flex:1;padding:9px 12px;font-size:12.5px;font-weight:700;border:none;
                         cursor:pointer;transition:.18s;font-family:'Poppins',sans-serif;
                         background:var(--blue);color:#fff;">
            üìÑ Manual (PDF)
          </button>
          <button type="button" id="ftab-vid" onclick="formTabContenido('vid')"
                  style="flex:1;padding:9px 12px;font-size:12.5px;font-weight:700;border:none;
                         cursor:pointer;transition:.18s;font-family:'Poppins',sans-serif;
                         background:#F8F9FA;color:var(--gray);border-left:2px solid var(--gray-light);">
            ‚ñ∂Ô∏è Video (YouTube)
          </button>
        </div>

        <!-- Panel PDF -->
        <div id="fpanel-pdf">
          <label class="pdf-drop" id="pdf-drop-zone">
            <div class="pdf-drop-icon">üìé</div>
            <div class="pdf-drop-label">Haz clic para adjuntar un PDF<br><small>M√°ximo 20 MB</small></div>
            <input type="file" id="form-pdf" accept=".pdf" style="display:none;" onchange="onPDFSelected(this)">
          </label>
          <div class="pdf-info" id="pdf-info">
            <span style="font-size:20px;">üìÑ</span>
            <div style="flex:1;min-width:0;">
              <div class="pdf-info-name" id="pdf-fname"></div>
              <div class="pdf-info-size" id="pdf-fsize"></div>
            </div>
            <button class="pdf-remove" onclick="quitarPDF(event)">‚úï</button>
          </div>
        </div>

        <!-- Panel Video -->
        <div id="fpanel-vid" style="display:none;">
          <input class="form-input" id="form-yt-url" type="url"
                 placeholder="https://www.youtube.com/watch?v=...">
          <div style="font-size:11px;color:var(--gray);margin-top:6px;">
            üìå Pega el enlace de YouTube del video tutorial.
          </div>
        </div>
      </div>

      <!-- Error -->
      <div class="alert-error" id="form-error" style="margin-bottom:16px;">
        ‚ö†Ô∏è Completa los campos obligatorios.
      </div>

      <!-- Botones -->
      <div style="display:flex;gap:10px;">
        <button class="btn-primary" onclick="guardarItem()" style="flex:1;">üíæ Guardar</button>
        <button class="btn-ghost" onclick="volverAlAdmin()">Cancelar</button>
      </div>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: CONFIRMACI√ìN DE ELIMINACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay" id="m-confirmar">
  <div class="modal" style="max-width:400px;">
    <div class="modal-head" style="background:linear-gradient(120deg,#8B4A3A,#B76452);">
      <div class="mh-left">
        <div class="mh-ico">üóëÔ∏è</div>
        <div><div class="mh-title">Eliminar</div><div class="mh-sub">Esta acci√≥n no se puede deshacer</div></div>
      </div>
      <button class="btn-mclose" onclick="openModal('m-admin')">‚úï</button>
    </div>
    <div class="confirm-body">
      <div class="confirm-icon">‚ö†Ô∏è</div>
      <div class="confirm-title">¬øEliminar este elemento?</div>
      <div class="confirm-sub" id="confirmar-nombre"></div>
      <div class="confirm-btns">
        <button class="btn-danger" id="btn-confirmar">üóëÔ∏è S√≠, eliminar</button>
        <button class="btn-ghost" onclick="openModal('m-admin')">Cancelar</button>
      </div>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     JAVASCRIPT ‚Äî Toda la l√≥gica del portal
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

</div><!-- /vista-ayuda -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VISTA 3: VALIDACI√ìN PAZ Y SALVO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="vista" id="vista-paz">

  <header class="mod-header">
    <div class="mod-home-ico" onclick="volverAlPortal()" title="Volver al inicio">
      <svg width="38" height="38" viewBox="0 0 24 24" fill="none">
        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9 21 9 15 12 15C15 15 15 21 15 21M9 21H15"
              stroke="#CC1F1F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="mod-header-center">
      <div class="mod-escudo">üèõÔ∏è</div>
      <div class="mod-alcaldia">
        <strong>Alcald√≠a</strong><span>de Colombia</span>
      </div>
    </div>
    <button class="mod-btn-acceder">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
        <path d="M15 3H19C19.5523 3 20 3.44772 20 4V20C20 20.5523 19.5523 21 19 21H15M10 17L15 12M15 12L10 7M15 12H3"
              stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Acceder
    </button>
  </header>

  <div class="mod-body">
    <h1 class="mod-title">Valide su Certificado de Paz y Salvo de Manera F√°cil</h1>

    <div class="paz-desc">
      <p>Verifique la autenticidad de su certificado ingresando los datos solicitados o escaneando el c√≥digo QR que se encuentra en su certificado.</p>
      <br>
      <p>Recuerde, a trav√©s de esta opci√≥n no se realiza la generaci√≥n de certificados, √∫nicamente permite la consulta de informaci√≥n.</p>
    </div>

    <div class="paz-form">
      <div class="paz-row">
        <label class="paz-label">N√∫mero de Certificado</label>
        <input class="paz-input" id="paz-cert" type="text" placeholder="">
      </div>
      <div class="paz-row">
        <label class="paz-label">N√∫mero de Documento</label>
        <input class="paz-input" id="paz-doc" type="text" placeholder="">
      </div>
      <div class="paz-btns">
        <button class="paz-btn-nueva" onclick="nuevaConsultaPaz()">Nueva Consulta</button>
        <button class="paz-btn-validar" onclick="validarPaz()">Validar Certificado</button>
      </div>
    </div>

    <!-- Resultado de la validaci√≥n -->
    <div class="paz-resultado ok" id="paz-resultado-ok">
      <div class="paz-res-icon">‚úÖ</div>
      <div class="paz-res-title">Certificado V√°lido</div>
      <div class="paz-res-detail">
        El certificado de Paz y Salvo ingresado es <strong>aut√©ntico y v√°lido</strong>.<br>
        Fue expedido por la Alcald√≠a de Colombia y se encuentra vigente en el sistema.
      </div>
    </div>
    <div class="paz-resultado err" id="paz-resultado-err">
      <div class="paz-res-icon">‚ùå</div>
      <div class="paz-res-title">Certificado No Encontrado</div>
      <div class="paz-res-detail">
        No se encontr√≥ un certificado con los datos ingresados.<br>
        Verifique el <strong>N√∫mero de Certificado</strong> y el <strong>N√∫mero de Documento</strong> e intente nuevamente.
      </div>
    </div>
  </div>

  <footer class="mod-footer">
    <div class="mod-footer-logo">sm<span class="logo-m">‚óÜ</span>rt</div>
    <p>Todos los derechos reservados ¬© SMART TMT 2026</p>
    <p class="mod-footer-version">ReleaseV.4.1.8</p>
  </footer>



  <!-- Bot√≥n ¬øNecesitas ayuda? ‚Äî solo en m√≥dulos internos -->
  <div class="mod-ayudas-wrap" id="ayudasWrap-paz">
    <div class="mod-ayudas-popup" id="ayudasPopup-paz">
      <div class="map-head">‚ùì ¬øNecesitas ayuda?</div>
      <div class="map-opt" onclick="irACentroAyuda('manuales','Paz y Salvo')">
        <div class="map-ico m">üìÑ</div>
        <div class="map-txt"><strong>Manuales de Usuario</strong><span>Instructivos de Paz y Salvo</span></div>
      </div>
      <div class="map-opt" onclick="irACentroAyuda('videos','Paz y Salvo')">
        <div class="map-ico v">‚ñ∂Ô∏è</div>
        <div class="map-txt"><strong>Videos Tutoriales</strong><span>Videos de Paz y Salvo</span></div>
      </div>
      <div class="map-close"><button class="map-close-btn" onclick="cerrarAyudas('paz')">‚úï Cerrar</button></div>
    </div>
    <div class="map-row">
      <div class="map-label">¬øNecesitas ayuda?</div>
      <button class="map-btn" onclick="toggleAyudas('paz')">‚ùì</button>
    </div>
  </div>

</div><!-- /vista-paz -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VISTA 4: CONSULTE, DESCARGUE Y PAGUE SU FACTURA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="vista" id="vista-factura">

  <header class="mod-header">
    <div class="mod-home-ico" onclick="volverAlPortal()" title="Volver al inicio">
      <svg width="38" height="38" viewBox="0 0 24 24" fill="none">
        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9 21 9 15 12 15C15 15 15 21 15 21M9 21H15"
              stroke="#CC1F1F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="mod-header-center">
      <div class="mod-escudo">üèõÔ∏è</div>
      <div class="mod-alcaldia">
        <strong>Alcald√≠a</strong><span>de Colombia</span>
      </div>
    </div>
    <button class="mod-btn-acceder">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
        <path d="M15 3H19C19.5523 3 20 3.44772 20 4V20C20 20.5523 19.5523 21 19 21H15M10 17L15 12M15 12L10 7M15 12H3"
              stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Acceder
    </button>
  </header>

  <div class="mod-body">
    <h1 class="mod-title">Consulte, Descargue y Pague su Factura</h1>

    <div class="fac-desc-box">
      Este m√≥dulo le permite consultar, descargar y pagar sus impuestos municipales en l√≠nea, de forma simple y segura.<br>
      Solo debe seleccionar el tipo de impuesto e ingresar al menos uno de los datos solicitados. Puede completar uno, varios o todos los campos, seg√∫n la informaci√≥n de la que disponga.
    </div>

    <div class="fac-form">
      <div class="fac-select-label">Seleccione Tipo de Impuesto <span class="req">*</span></div>
      <select class="fac-select" id="fac-tipo" onchange="onTipoImpuesto(this.value)">
        <option value="">--seleccionar--</option>
        <option value="ica">ICA ‚Äî Impuesto de Industria y Comercio</option>
        <option value="ipu">IPU ‚Äî Impuesto Predial Unificado</option>
        <option value="vehiculos">Veh√≠culos</option>
        <option value="azar">Juegos de Azar y Espect√°culos</option>
      </select>

      <!-- Campos din√°micos seg√∫n impuesto -->
      <div class="fac-fields" id="fac-fields-ica">
        <div class="fac-fields-title">Ingrese al menos uno de los siguientes datos</div>
        <div class="fac-field-group">
          <label class="fac-field-label">NIT / N√∫mero de Documento</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 900123456-1">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">N√∫mero de Factura</label>
          <input class="fac-field-input" type="text" placeholder="Ej: ICA-2026-00123">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">Per√≠odo Gravable</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 2025">
        </div>
        <button class="fac-btn-consultar">Consultar Factura</button>
        <button class="fac-btn-limpiar" onclick="limpiarFactura()">Nueva Consulta</button>
      </div>

      <div class="fac-fields" id="fac-fields-ipu">
        <div class="fac-fields-title">Ingrese al menos uno de los siguientes datos</div>
        <div class="fac-field-group">
          <label class="fac-field-label">N√∫mero de Predial / Chip</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 00-01-0001-0001-000">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">C√©dula Catastral</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 12345678">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">N√∫mero de Documento del Propietario</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 12345678">
        </div>
        <button class="fac-btn-consultar">Consultar Factura</button>
        <button class="fac-btn-limpiar" onclick="limpiarFactura()">Nueva Consulta</button>
      </div>

      <div class="fac-fields" id="fac-fields-vehiculos">
        <div class="fac-fields-title">Ingrese al menos uno de los siguientes datos</div>
        <div class="fac-field-group">
          <label class="fac-field-label">Placa del Veh√≠culo</label>
          <input class="fac-field-input" type="text" placeholder="Ej: ABC123">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">N√∫mero de Documento del Propietario</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 12345678">
        </div>
        <button class="fac-btn-consultar">Consultar Factura</button>
        <button class="fac-btn-limpiar" onclick="limpiarFactura()">Nueva Consulta</button>
      </div>

      <div class="fac-fields" id="fac-fields-azar">
        <div class="fac-fields-title">Ingrese al menos uno de los siguientes datos</div>
        <div class="fac-field-group">
          <label class="fac-field-label">NIT / N√∫mero de Documento</label>
          <input class="fac-field-input" type="text" placeholder="Ej: 900123456-1">
        </div>
        <div class="fac-field-group">
          <label class="fac-field-label">N√∫mero de Resoluci√≥n</label>
          <input class="fac-field-input" type="text" placeholder="Ej: RES-2026-00456">
        </div>
        <button class="fac-btn-consultar">Consultar Factura</button>
        <button class="fac-btn-limpiar" onclick="limpiarFactura()">Nueva Consulta</button>
      </div>

    </div>
  </div>

  <footer class="mod-footer">
    <div class="mod-footer-logo">sm<span class="logo-m">‚óÜ</span>rt</div>
    <p>Todos los derechos reservados ¬© SMART TMT 2026</p>
    <p class="mod-footer-version">ReleaseV.4.1.8</p>
  </footer>



  <!-- Bot√≥n ¬øNecesitas ayuda? ‚Äî solo en m√≥dulos internos -->
  <div class="mod-ayudas-wrap" id="ayudasWrap-factura">
    <div class="mod-ayudas-popup" id="ayudasPopup-factura">
      <div class="map-head">‚ùì ¬øNecesitas ayuda?</div>
      <div class="map-opt" onclick="irACentroAyuda('manuales','Factura Express')">
        <div class="map-ico m">üìÑ</div>
        <div class="map-txt"><strong>Manuales de Usuario</strong><span>Instructivos de Factura Express</span></div>
      </div>
      <div class="map-opt" onclick="irACentroAyuda('videos','Factura Express')">
        <div class="map-ico v">‚ñ∂Ô∏è</div>
        <div class="map-txt"><strong>Videos Tutoriales</strong><span>Videos de Factura Express</span></div>
      </div>
      <div class="map-close"><button class="map-close-btn" onclick="cerrarAyudas('factura')">‚úï Cerrar</button></div>
    </div>
    <div class="map-row">
      <div class="map-label">¬øNecesitas ayuda?</div>
      <button class="map-btn" onclick="toggleAyudas('factura')">‚ùì</button>
    </div>
  </div>

</div><!-- /vista-factura -->


<script>
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     NAVEGACI√ìN ENTRE VISTAS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function cambiarVista(id) {
    document.querySelectorAll('.vista').forEach(v => v.classList.remove('activa'));
    document.getElementById(id).classList.add('activa');
    window.scrollTo(0, 0);
  }

  function irACentroAyudaDesdePortal() {
    cambiarVista('vista-ayuda');
    /* Limpia la barra de b√∫squeda al entrar desde el portal base */
    const searchInput = document.getElementById('global-search');
    const clearBtn    = document.getElementById('search-clear');
    if (searchInput) searchInput.value = '';
    if (clearBtn)    clearBtn.classList.remove('visible');
    renderPortal('');
  }
  function irAPazSalvo()  { cambiarVista('vista-paz'); nuevaConsultaPaz(); }
  function irAFactura()   { cambiarVista('vista-factura'); limpiarFactura(); }
  function volverAlPortal() { cambiarVista('vista-portal'); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DOTS CAROUSEL (portal base)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const pbDots = document.querySelectorAll('.pb-dot');
  let pbCurrent = 1;
  setInterval(() => {
    pbDots.forEach(d => d.classList.remove('active'));
    pbCurrent = (pbCurrent + 1) % pbDots.length;
    pbDots[pbCurrent].classList.add('active');
  }, 3000);

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     M√ìDULO: PAZ Y SALVO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function nuevaConsultaPaz() {
    document.getElementById('paz-cert').value = '';
    document.getElementById('paz-doc').value  = '';
    document.getElementById('paz-resultado-ok').classList.remove('show');
    document.getElementById('paz-resultado-err').classList.remove('show');
  }

  function validarPaz() {
    const cert = document.getElementById('paz-cert').value.trim();
    const doc  = document.getElementById('paz-doc').value.trim();
    if (!cert || !doc) {
      alert('Por favor ingrese el N√∫mero de Certificado y el N√∫mero de Documento.');
      return;
    }
    document.getElementById('paz-resultado-ok').classList.remove('show');
    document.getElementById('paz-resultado-err').classList.remove('show');
    /* Simulaci√≥n: n√∫meros que terminan en par ‚Üí v√°lido, impar ‚Üí no encontrado */
    const esValido = parseInt(cert.slice(-1)) % 2 === 0;
    setTimeout(() => {
      document.getElementById(esValido ? 'paz-resultado-ok' : 'paz-resultado-err')
              .classList.add('show');
    }, 400);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     M√ìDULO: CONSULTAR FACTURA
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function onTipoImpuesto(val) {
    /* Oculta todos los bloques de campos */
    document.querySelectorAll('.fac-fields').forEach(f => f.classList.remove('show'));
    if (val) {
      const target = document.getElementById('fac-fields-' + val);
      if (target) target.classList.add('show');
    }
  }

  function limpiarFactura() {
    document.getElementById('fac-tipo').value = '';
    document.querySelectorAll('.fac-fields').forEach(f => f.classList.remove('show'));
    document.querySelectorAll('.fac-field-input').forEach(i => i.value = '');
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BOT√ìN AYUDAS PR√ÅCTICAS (m√≥dulos internos)
     Cada funci√≥n navega al Centro de Ayuda
     con la pesta√±a y filtro correspondiente
     al m√≥dulo de origen.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function toggleAyudas(mod) {
    const popup = document.getElementById('ayudasPopup-' + mod);
    popup.classList.toggle('show');
  }
  function cerrarAyudas(mod) {
    document.getElementById('ayudasPopup-' + mod).classList.remove('show');
  }

  /* Navega al Centro de Ayuda aplicando pesta√±a y filtro seg√∫n el m√≥dulo origen */
  function irACentroAyuda(tab, filtro) {
    /* Cierra cualquier popup abierto */
    document.querySelectorAll('.mod-ayudas-popup').forEach(p => p.classList.remove('show'));

    /* Navega a la vista del centro de ayuda */
    cambiarVista('vista-ayuda');

    /* Aplica la pesta√±a correcta */
    tabActual = tab;
    document.getElementById('tab-manuales').classList.toggle('active', tab === 'manuales');
    document.getElementById('tab-videos').classList.toggle('active', tab === 'videos');

    /* Aplica el filtro en el buscador y renderiza */
    const searchInput = document.getElementById('global-search');
    const clearBtn    = document.getElementById('search-clear');
    searchInput.value = filtro;
    if (clearBtn) clearBtn.classList.toggle('visible', filtro.length > 0);

    renderPortal(filtro);
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TODO EL JS DEL CENTRO DE AYUDA
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DATOS DEL PORTAL
     Estructura de secciones y sus √≠tems (manuales y videos).
     Cada secci√≥n tiene: id, n√∫mero, √≠cono, nombre, color.
     Cada √≠tem tiene: id, secId, num, icono, nombre, version, fecha,
                      visible, pdfData, pdfNombre, ytUrl.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const SECCIONES = [
    { id:'s1', num:'1', ico:'üë§', nombre:'Datos B√°sicos',       color:'#CC1F1F' },
    { id:'s2', num:'2', ico:'üßæ', nombre:'Factura Express',     color:'#B31B1B' },
    { id:'s3', num:'3', ico:'‚úÖ', nombre:'Paz y Salvo',         color:'#C42B2B' },
    { id:'s4', num:'4', ico:'üìù', nombre:'RIT',                 color:'#D63B3B' },
    { id:'s5', num:'5', ico:'‚úçÔ∏è', nombre:'Firma Electr√≥nica',  color:'#A31515' },
    { id:'s6', num:'6', ico:'üìã', nombre:'Declaraciones',       color:'#BE185D' },
  ];

  /* Todos los √≠tems compartidos por manuales y videos.
     ytUrl ‚Üí enlace del video (si aplica para la pesta√±a de videos) */
  let ITEMS = [
    { id:1,  secId:'s1', num:'1.1', icono:'üîë', nombre:'Inicio de sesi√≥n contribuyente',      version:'1.0', fecha:'2026-01-10', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:2,  secId:'s1', num:'1.2', icono:'‚úçÔ∏è', nombre:'Inicio de sesi√≥n firmante',           version:'1.0', fecha:'2026-01-10', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:3,  secId:'s1', num:'1.3', icono:'üë§', nombre:'Registro de usuario',                  version:'1.2', fecha:'2026-01-15', visible:true, pdfData:null, pdfNombre:null, ytUrl:'https://www.youtube.com/watch?v=bPUmIHjvT64' },
    { id:4,  secId:'s1', num:'1.4', icono:'üîì', nombre:'Recuperar contrase√±a',                 version:'1.1', fecha:'2026-01-12', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:5,  secId:'s1', num:'1.5', icono:'üîí', nombre:'Cambiar contrase√±a',                   version:'1.0', fecha:'2026-01-10', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:6,  secId:'s2', num:'2.1', icono:'üßæ', nombre:'Factura express ICA',                  version:'2.0', fecha:'2026-01-20', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:7,  secId:'s2', num:'2.2', icono:'üè†', nombre:'Factura express IPU',                  version:'2.0', fecha:'2026-01-20', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:8,  secId:'s3', num:'3.1', icono:'‚úÖ', nombre:'Generar certificado paz y salvo',      version:'1.4', fecha:'2026-01-22', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:9,  secId:'s3', num:'3.2', icono:'üîç', nombre:'Validar certificado paz y salvo',      version:'1.1', fecha:'2026-01-22', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:10, secId:'s4', num:'4.1', icono:'üìù', nombre:'Inscripci√≥n de RIT',                   version:'1.1', fecha:'2026-01-05', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:11, secId:'s4', num:'4.2', icono:'üîÑ', nombre:'Actualizaci√≥n RIT',                    version:'1.0', fecha:'2026-01-05', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:12, secId:'s4', num:'4.3', icono:'üö´', nombre:'Cierre de RIT',                        version:'1.0', fecha:'2026-01-05', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:13, secId:'s5', num:'5.1', icono:'‚ö°', nombre:'Habilitaci√≥n de firma electr√≥nica',    version:'1.2', fecha:'2026-01-18', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:14, secId:'s5', num:'5.2', icono:'üì§', nombre:'Presentaci√≥n virtual de un formulario',version:'1.0', fecha:'2026-01-18', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:15, secId:'s5', num:'5.3', icono:'ü§ù', nombre:'Acuerdo firma electr√≥nica',            version:'1.0', fecha:'2026-01-18', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
    { id:16, secId:'s6', num:'6.1', icono:'üìã', nombre:'Diligenciar formulario ICA',           version:'3.0', fecha:'2026-01-20', visible:true, pdfData:null, pdfNombre:null, ytUrl:'' },
  ];

  let nextId    = 17;
  let tabActual = 'manuales';  /* Pesta√±a activa: 'manuales' | 'videos' */
  let editId    = null;
  let elimId    = null;
  const ICONOS  = ['üìÑ','üìã','‚úèÔ∏è','üìë','üí≥','üë§','üìù','üì§','‚úçÔ∏è','‚úÖ','üîë','üîì','üîí','üîç','üßæ','üè†','üîÑ','üö´','‚ö°','ü§ù','üìä','üéØ','‚ÑπÔ∏è','‚öôÔ∏è'];
  const ADMIN_U = '12345', ADMIN_P = '12345';

  /* ‚îÄ‚îÄ Contadores de uso ‚Äî se acumulan en la sesi√≥n ‚îÄ‚îÄ */
  const stats = { pdf:{}, vid:{} };
  function registrarVista(tipo, itemId) {
    if (!stats[tipo][itemId]) stats[tipo][itemId] = 0;
    stats[tipo][itemId]++;
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     RENDER PRINCIPAL
     Construye el sidebar y las secciones de tarjetas
     seg√∫n la pesta√±a activa y el filtro de b√∫squeda.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function renderPortal(filtro = '') {
    const sidebar  = document.getElementById('sidebar');
    const main     = document.querySelector('.main-area');
    const empty    = document.getElementById('empty-state');
    const q        = filtro.toLowerCase();

    /* Limpia el √°rea principal conservando el empty-state */
    main.querySelectorAll('.seccion-bloque').forEach(el => el.remove());
    sidebar.innerHTML = '<div class="sidebar-title">M√≥dulos</div>';

    let totalVisible = 0;

    SECCIONES.forEach(sec => {
      /* Filtra √≠tems de esta secci√≥n que sean visibles y coincidan con la b√∫squeda */
      const items = ITEMS.filter(it =>
        it.secId === sec.id &&
        it.visible &&
        (q === '' || it.nombre.toLowerCase().includes(q) || sec.nombre.toLowerCase().includes(q) || it.num.includes(q))
      );

      if (items.length === 0) return; /* Oculta secciones vac√≠as */
      totalVisible += items.length;

      /* ‚îÄ‚îÄ Item del sidebar ‚îÄ‚îÄ */
      const sItem = document.createElement('div');
      sItem.className = 'sec-item';
      sItem.id = `nav-${sec.id}`;
      sItem.dataset.nombre = sec.nombre.toLowerCase();
      sItem.innerHTML = `
        <span class="sec-item-icon">${sec.ico}</span>
        <span class="sec-item-label">${sec.nombre}</span>
        <span class="sec-item-badge">${items.length}</span>`;
      sItem.onclick = () => {
        document.getElementById(`bloque-${sec.id}`)?.scrollIntoView({ behavior:'smooth', block:'start' });
        document.querySelectorAll('.sec-item').forEach(s => s.classList.remove('active'));
        sItem.classList.add('active');
      };
      sidebar.appendChild(sItem);

      /* ‚îÄ‚îÄ Bloque de secci√≥n ‚îÄ‚îÄ */
      const bloque = document.createElement('div');
      bloque.className = 'seccion-bloque';
      bloque.id = `bloque-${sec.id}`;

      bloque.innerHTML = `
        <div class="seccion-header">
          <div class="seccion-num" style="background:linear-gradient(135deg,${sec.color}CC,${sec.color});">${sec.ico}</div>
          <div>
            <div class="seccion-title">${sec.nombre}</div>
            <div class="seccion-sub">${items.length} ${tabActual === 'manuales' ? 'instructivo' : 'video'}${items.length !== 1 ? 's' : ''} disponible${items.length !== 1 ? 's' : ''}</div>
          </div>
        </div>
        <div class="items-grid" id="grid-${sec.id}"></div>`;

      main.appendChild(bloque);

      const grid = document.getElementById(`grid-${sec.id}`);

      /* ‚îÄ‚îÄ Tarjetas ‚îÄ‚îÄ */
      items.forEach(it => {
        const card = document.createElement('div');
        const fechaFmt = it.fecha ? it.fecha.split('-').reverse().join('/') : '‚Äî';

        if (tabActual === 'manuales') {
          /* Tarjeta de manual */
          card.className = 'manual-card';
          card.onclick = () => abrirPDF(it);
          card.innerHTML = `
            <div class="manual-card-accent"></div>
            <div class="manual-card-icon">${it.icono}</div>
            <div class="manual-card-info">
              <div class="manual-card-name">${it.nombre}</div>
              <div class="manual-card-meta">Versi√≥n ${it.version} ¬∑ ${fechaFmt}</div>
            </div>
            <div class="manual-card-btn">üìñ</div>`;
        } else {
          /* Tarjeta de video */
          card.className = 'video-card';
          card.onclick = () => abrirVideo(it);
          card.innerHTML = `
            <div class="video-card-accent"></div>
            <div class="video-card-thumb">‚ñ∂Ô∏è</div>
            <div class="video-card-info">
              <div class="video-card-name">${it.nombre}</div>
              <div class="video-card-meta">${it.ytUrl ? 'üîó Video disponible' : '‚è≥ Pr√≥ximamente'} ¬∑ ${fechaFmt}</div>
            </div>
            <div class="video-card-btn">‚ñ∂</div>`;
        }

        grid.appendChild(card);
      });
    });

    /* Muestra / oculta el empty state */
    empty.classList.toggle('visible', totalVisible === 0 && q !== '');

    /* Actualiza contadores de tabs */
    actualizarContadores();
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CONTADORES DE TABS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function actualizarContadores() {
    const vis = ITEMS.filter(i => i.visible);
    document.getElementById('tc-manuales').textContent = vis.length;
    document.getElementById('tc-videos').textContent   = vis.length;
    document.getElementById('stat-manuales').textContent = vis.length;
    document.getElementById('stat-videos').textContent   = vis.length;
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BUSCADOR DEL SIDEBAR
     Filtra los √≠tems del sidebar por nombre de m√≥dulo.
     Solo muestra/oculta los items sin re-renderizar todo.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function filtrarSidebar(q) {
    const items = document.querySelectorAll('#sidebar .sec-item');
    const texto = q.toLowerCase().trim();
    items.forEach(item => {
      const nombre = item.dataset.nombre || '';
      item.style.display = (texto === '' || nombre.includes(texto)) ? 'flex' : 'none';
    });
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BUSCADOR GLOBAL
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function buscarGlobal(q) {
    document.getElementById('search-clear').classList.toggle('visible', q.length > 0);
    renderPortal(q);
  }
  function limpiarBusqueda() {
    document.getElementById('global-search').value = '';
    document.getElementById('search-clear').classList.remove('visible');
    renderPortal();
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CAMBIO DE PESTA√ëA (Manuales / Videos)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function cambiarTab(tab) {
    tabActual = tab;
    document.getElementById('tab-manuales').classList.toggle('active', tab === 'manuales');
    document.getElementById('tab-videos').classList.toggle('active', tab === 'videos');

    const q = document.getElementById('global-search').value;
    renderPortal(q);
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABRIR PDF
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function abrirPDF(item) {
    registrarVista('pdf', item.id);
    closeAll();
    document.getElementById('pdf-title').textContent = `${item.num} ‚Äî ${item.nombre}`;
    const body = document.getElementById('pdf-body');
    const nav  = document.getElementById('pdf-nav');

    if (item.pdfData) {
      body.innerHTML = '<div class="pdf-placeholder"><div class="big-icon">‚è≥</div><p>Cargando documento‚Ä¶</p></div>';
      nav.style.display = 'none';
      openModal('m-pdf');
      /* Renderiza con PDF.js despu√©s de abrir el modal */
      setTimeout(() => pdfCargar(item.pdfData), 80);
    } else {
      body.innerHTML = `
        <div class="pdf-placeholder">
          <div class="big-icon">üìÑ</div>
          <p>Vista previa no disponible</p>
          <small>Este manual a√∫n no tiene un archivo PDF cargado.<br>El administrador puede cargarlo desde el panel de gesti√≥n.</small>
        </div>`;
      nav.style.display = 'none';
      openModal('m-pdf');
    }
  }
  function closePDF() { closeAll(); }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABRIR VIDEO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABRIR VIDEO ‚Äî Reproductor con thumbnail
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REPRODUCTOR DE VIDEO ‚Äî iframe embed en localhost
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  let _videoUrl = '';
  let _videoId  = '';

  function extraerVideoId(url) {
    try {
      if (url.includes('watch?v='))  return new URLSearchParams(url.split('?')[1]).get('v');
      if (url.includes('youtu.be/')) return url.split('youtu.be/')[1].split(/[?&]/)[0];
      if (url.includes('/embed/'))   return url.split('/embed/')[1].split(/[?&]/)[0];
    } catch(e) {}
    return '';
  }

  function abrirVideo(item) {
    registrarVista('vid', item.id);
    closeAll();

    document.getElementById('video-title').textContent = item.nombre;
    document.getElementById('video-sub').textContent   = `Secci√≥n ${item.num}`;

    const url        = item.ytUrl || '';
    const playerWrap = document.getElementById('video-player-wrap');
    const noUrl      = document.getElementById('video-no-url');

    _videoUrl = url;
    _videoId  = url ? extraerVideoId(url) : '';

    if (url) {
      /* Thumbnail: intenta maxresdefault, fallback a hqdefault */
      const thumbImg = document.getElementById('video-thumb-img');
      thumbImg.src = _videoId
        ? `https://img.youtube.com/vi/${_videoId}/maxresdefault.jpg`
        : '';
      thumbImg.onerror = function() {
        if (_videoId && this.src.includes('maxresdefault')) {
          this.src = `https://img.youtube.com/vi/${_videoId}/hqdefault.jpg`;
        } else {
          this.src = '';
        }
      };

      document.getElementById('video-footer-name').textContent = item.nombre;
      document.getElementById('video-yt-ext').href = url;

      /* Resetea a estado thumbnail */
      document.getElementById('video-thumb-wrap').style.display   = 'block';
      document.getElementById('video-yt-container').innerHTML      = '';
      document.getElementById('video-yt-container').style.display  = 'none';

      playerWrap.style.display = 'block';
      noUrl.style.display      = 'none';
    } else {
      playerWrap.style.display = 'none';
      noUrl.style.display      = 'flex';
    }

    openModal('m-video');
  }

  /* Al hacer clic en la thumbnail ‚Äî inyecta iframe con autoplay */
  function iniciarReproduccion() {
    if (!_videoId) return;
    const thumbWrap = document.getElementById('video-thumb-wrap');
    const ytCont    = document.getElementById('video-yt-container');

    /* Construye URL embed con autoplay (funciona en http://) */
    const embedSrc = `https://www.youtube-nocookie.com/embed/${_videoId}` +
                     `?autoplay=1&rel=0&modestbranding=1&playsinline=1`;

    /* Inyecta el iframe al hacer clic ‚Äî as√≠ el autoplay siempre se activa
       porque viene de un gesto del usuario */
    ytCont.innerHTML = `<iframe
      src="${embedSrc}"
      style="width:100%;height:100%;border:none;display:block;"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media;
             gyroscope; picture-in-picture; web-share"
      allowfullscreen>
    </iframe>`;

    thumbWrap.style.display  = 'none';
    ytCont.style.display     = 'block';
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODALES ‚Äî Abrir / cerrar
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function openModal(id) {
    document.getElementById(id).classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeAll() {
    document.querySelectorAll('.overlay').forEach(o => o.classList.remove('open'));
    document.body.style.overflow = '';
    /* Detiene el video destruyendo el iframe inyectado */
    const ytCont = document.getElementById('video-yt-container');
    if (ytCont) { ytCont.innerHTML = ''; ytCont.style.display = 'none'; }
    const thumbWrap = document.getElementById('video-thumb-wrap');
    if (thumbWrap) thumbWrap.style.display = 'block';
    _videoUrl = '';
    _videoId  = '';
  }
  document.querySelectorAll('.overlay').forEach(o =>
    o.addEventListener('click', e => { if (e.target === o) closeAll(); })
  );
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeAll(); });


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTENTICACI√ìN
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function doLogin() {
    const u = document.getElementById('login-user').value.trim();
    const p = document.getElementById('login-pass').value.trim();
    const err = document.getElementById('login-error');
    if (u === ADMIN_U && p === ADMIN_P) {
      err.style.display = 'none';
      document.getElementById('login-user').value = '';
      document.getElementById('login-pass').value = '';
      closeAll();
      renderAdmin();
      /* Siempre inicia en la pesta√±a de Gesti√≥n al entrar */
      document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
      document.getElementById('atab-gestion').classList.add('active');
      document.getElementById('apanel-gestion').classList.add('active');
      openModal('m-admin');
    } else {
      err.style.display = 'block';
    }
  }
  function cerrarSesion() { closeAll(); }

  /* Vuelve al panel admin desde el formulario (X o Cancelar) */
  function volverAlAdmin() {
    closeAll();
    renderAdmin();
    openModal('m-admin');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PANEL DE ADMINISTRACI√ìN ‚Äî Render de tabla
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function renderAdmin(filtro = '') {
    const tbody = document.getElementById('admin-tbody');
    const count = document.getElementById('admin-count');
    tbody.innerHTML = '';

    const lista = ITEMS.filter(it =>
      it.nombre.toLowerCase().includes(filtro.toLowerCase()) ||
      it.num.includes(filtro)
    );

    lista.forEach(it => {
      const sec = SECCIONES.find(s => s.id === it.secId);
      const fechaFmt = it.fecha ? it.fecha.split('-').reverse().join('/') : '‚Äî';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="font-size:22px;">${it.icono}</td>
        <td style="font-size:12px;color:var(--gray);">${sec?.nombre || '‚Äî'}</td>
        <td style="font-weight:500;color:${it.visible ? 'var(--blue-dark)' : 'var(--gray)'};word-break:break-word;">
          ${it.nombre}
        </td>
        <td style="color:var(--gray);">v${it.version}</td>
        <td style="color:var(--gray);font-size:12px;">${fechaFmt}</td>
        <td style="text-align:center;">
          <span class="badge-vis ${it.visible ? 'on' : 'off'}">${it.visible ? '‚óè Visible' : '‚óã Oculto'}</span>
        </td>
        <td>
          <div class="action-btns">
            <button class="act-btn edit" onclick="abrirFormulario(${it.id})" title="Editar">‚úèÔ∏è</button>
            <button class="act-btn ${it.visible ? 'vis' : 'show'}"
                    onclick="toggleVisible(${it.id})"
                    title="${it.visible ? 'Ocultar' : 'Mostrar'}">
              ${it.visible ? 'üëÅÔ∏è' : 'üôà'}
            </button>
            <button class="act-btn del" onclick="confirmarEliminar(${it.id})" title="Eliminar">üóëÔ∏è</button>
          </div>
        </td>`;
      tbody.appendChild(tr);
    });

    const vis = ITEMS.filter(i => i.visible).length;
    count.textContent = `${lista.length} elemento${lista.length !== 1 ? 's' : ''} ‚Äî ${vis} visibles, ${ITEMS.length - vis} ocultos`;
  }

  function filtrarAdmin(q) { renderAdmin(q); }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FORMULARIO ‚Äî Abrir (agregar o editar)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  /* Abre el formulario forzando el tipo correcto (desde los botones del admin) */
  function abrirFormularioTipo(tipo) {
    tabActual = tipo; /* Fuerza la pesta√±a antes de abrir el form */
    abrirFormulario(null);
  }

  /* Alterna entre las pesta√±as PDF / Video dentro del formulario */
  function formTabContenido(tab) {
    const isPdf = tab === 'pdf';
    document.getElementById('fpanel-pdf').style.display = isPdf ? 'block' : 'none';
    document.getElementById('fpanel-vid').style.display = isPdf ? 'none'  : 'block';
    const btnPdf = document.getElementById('ftab-pdf');
    const btnVid = document.getElementById('ftab-vid');
    btnPdf.style.background = isPdf ? 'var(--blue)' : '#F8F9FA';
    btnPdf.style.color      = isPdf ? '#fff'        : 'var(--gray)';
    btnVid.style.background = isPdf ? '#F8F9FA'     : 'var(--blue)';
    btnVid.style.color      = isPdf ? 'var(--gray)' : '#fff';
  }

  function abrirFormulario(id = null) {
    editId = id;
    const titulo = document.getElementById('form-modal-title');
    const err    = document.getElementById('form-error');
    err.style.display = 'none';

    /* Poblar selector de secciones */
    const sel = document.getElementById('form-seccion');
    sel.innerHTML = '<option value="">‚Äî Selecciona una secci√≥n ‚Äî</option>';
    SECCIONES.forEach(s => {
      sel.innerHTML += `<option value="${s.id}">${s.nombre}</option>`;
    });

    /* Construir picker de √≠conos */
    const picker = document.getElementById('icon-picker');
    picker.innerHTML = '';
    ICONOS.forEach(ico => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'ico-opt';
      btn.textContent = ico;
      btn.onclick = () => {
        picker.querySelectorAll('.ico-opt').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById('form-icono').value = ico;
        document.getElementById('form-ico-display').textContent = ico;
      };
      picker.appendChild(btn);
    });

    /* Limpiar PDF */
    resetPDFDrop();

    if (id !== null) {
      /* Modo edici√≥n: precarga datos */
      const it = ITEMS.find(x => x.id === id);
      titulo.textContent = 'Editar elemento';
      document.getElementById('form-icono').value   = it.icono;
      document.getElementById('form-ico-display').textContent = it.icono;
      document.getElementById('form-seccion').value = it.secId;
      document.getElementById('form-num').value     = it.num;
      document.getElementById('form-nombre').value  = it.nombre;
      document.getElementById('form-version').value = it.version;
      document.getElementById('form-fecha').value   = it.fecha;
      document.getElementById('form-yt-url').value  = it.ytUrl || '';

      /* Marca √≠cono actual */
      picker.querySelectorAll('.ico-opt').forEach(b => {
        if (b.textContent === it.icono) b.classList.add('selected');
      });

      /* Activa pesta√±a seg√∫n qu√© contenido tiene el √≠tem:
         si tiene URL de video ‚Üí muestra video; si tiene PDF ‚Üí muestra PDF */
      const tabInicial = (it.ytUrl && !it.pdfData) ? 'vid' : 'pdf';
      formTabContenido(tabInicial);

      /* Muestra PDF existente si tiene */
      if (it.pdfData) {
        const zone = document.getElementById('pdf-drop-zone');
        zone.className = 'pdf-drop has-file';
        document.querySelector('.pdf-drop-label').innerHTML =
          `<span style="color:var(--green);font-weight:600;">‚úÖ PDF cargado</span><br><small>Haz clic para reemplazar</small>`;
        const info = document.getElementById('pdf-info');
        document.getElementById('pdf-fname').textContent = it.pdfNombre || 'archivo.pdf';
        document.getElementById('pdf-fsize').textContent = 'PDF existente';
        info.classList.add('visible');
      }
    } else {
      /* Modo creaci√≥n: determina pesta√±a inicial seg√∫n tipo seleccionado */
      titulo.textContent = tabActual === 'manuales' ? 'Agregar Manual' : 'Agregar Video';
      formTabContenido(tabActual === 'manuales' ? 'pdf' : 'vid');
      document.getElementById('form-icono').value   = 'üìÑ';
      document.getElementById('form-ico-display').textContent = 'üìÑ';
      document.getElementById('form-seccion').value = '';
      document.getElementById('form-num').value     = '';
      document.getElementById('form-nombre').value  = '';
      document.getElementById('form-version').value = '';
      document.getElementById('form-fecha').value   = new Date().toISOString().split('T')[0];
      document.getElementById('form-yt-url').value  = '';
      /* Marca primer √≠cono por defecto */
      picker.querySelector('.ico-opt')?.classList.add('selected');
    }

    closeAll();
    openModal('m-form');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GUARDAR √çTEM
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function guardarItem() {
    const seccion = document.getElementById('form-seccion').value;
    const num     = document.getElementById('form-num').value.trim();
    const nombre  = document.getElementById('form-nombre').value.trim();
    const version = document.getElementById('form-version').value.trim();
    const fecha   = document.getElementById('form-fecha').value;
    const icono   = document.getElementById('form-icono').value;
    const ytUrl   = document.getElementById('form-yt-url').value.trim();
    const err     = document.getElementById('form-error');

    if (!seccion || !num || !nombre || !version || !fecha) {
      err.style.display = 'block'; return;
    }
    err.style.display = 'none';

    const file = document.getElementById('form-pdf').files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => _save(seccion, num, nombre, version, fecha, icono, ytUrl, e.target.result, file.name);
      reader.readAsDataURL(file);
    } else {
      const pdfExistente = editId !== null ? (ITEMS.find(x => x.id === editId)?.pdfData || null) : null;
      const nomExistente = editId !== null ? (ITEMS.find(x => x.id === editId)?.pdfNombre || null) : null;
      _save(seccion, num, nombre, version, fecha, icono, ytUrl, pdfExistente, nomExistente);
    }
  }

  function _save(secId, num, nombre, version, fecha, icono, ytUrl, pdfData, pdfNombre) {
    if (editId !== null) {
      const it = ITEMS.find(x => x.id === editId);
      Object.assign(it, { secId, num, nombre, version, fecha, icono, ytUrl });
      if (pdfData) { it.pdfData = pdfData; it.pdfNombre = pdfNombre; }
    } else {
      ITEMS.push({ id:nextId++, secId, num, nombre, busqueda:nombre.toLowerCase(), version, fecha, icono, ytUrl, visible:true, pdfData, pdfNombre });
    }
    /* Reordena por n√∫mero de √≠tem */
    ITEMS.sort((a, b) => a.num.localeCompare(b.num, undefined, { numeric:true }));
    closeAll(); renderAdmin(); renderPortal(); openModal('m-admin');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VISIBILIDAD Y ELIMINACI√ìN
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function toggleVisible(id) {
    const it = ITEMS.find(x => x.id === id);
    it.visible = !it.visible;
    renderAdmin(); renderPortal();
  }

  function confirmarEliminar(id) {
    elimId = id;
    const it = ITEMS.find(x => x.id === id);
    document.getElementById('confirmar-nombre').textContent = `"${it.icono} ${it.nombre}" ser√° eliminado permanentemente.`;
    document.getElementById('btn-confirmar').onclick = () => {
      ITEMS = ITEMS.filter(x => x.id !== id);
      closeAll(); renderAdmin(); renderPortal(); openModal('m-admin');
    };
    closeAll(); openModal('m-confirmar');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MANEJO DE PDF EN FORMULARIO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function onPDFSelected(input) {
    const file = input.files[0];
    if (!file) return;
    const zone = document.getElementById('pdf-drop-zone');
    zone.className = 'pdf-drop has-file';
    document.querySelector('.pdf-drop-label').innerHTML =
      `<span style="color:var(--green);font-weight:600;">‚úÖ PDF adjuntado</span><br><small>Haz clic para cambiar</small>`;
    const info = document.getElementById('pdf-info');
    document.getElementById('pdf-fname').textContent = file.name;
    document.getElementById('pdf-fsize').textContent = `${(file.size/1024/1024).toFixed(2)} MB`;
    info.classList.add('visible');
  }

  function quitarPDF(e) {
    e.preventDefault();
    document.getElementById('form-pdf').value = '';
    resetPDFDrop();
  }

  function resetPDFDrop() {
    document.getElementById('form-pdf').value = '';
    document.getElementById('pdf-info').classList.remove('visible');
    const zone = document.getElementById('pdf-drop-zone');
    zone.className = 'pdf-drop';
    document.querySelector('.pdf-drop-label').innerHTML =
      `Haz clic para adjuntar un PDF<br><small>M√°ximo 20 MB</small>`;
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BOT√ìN FLOTANTE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */



  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TABS DEL PANEL ADMIN
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function switchAdminTab(tab) {
    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
    document.getElementById(`atab-${tab}`).classList.add('active');
    document.getElementById(`apanel-${tab}`).classList.add('active');
    if (tab === 'stats') {
      /* Inicializa fechas del rango personalizado */
      const today = new Date();
      const fmt = d => d.toISOString().split('T')[0];
      const weekAgo = new Date(today); weekAgo.setDate(weekAgo.getDate() - 7);
      document.getElementById('date-from').value = fmt(weekAgo);
      document.getElementById('date-to').value   = fmt(today);
      renderStats();
    }
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FILTRO DE PER√çODO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  let activePeriod = 'today';

  function setPeriod(period, btn) {
    activePeriod = period;
    /* Actualiza pills */
    document.querySelectorAll('.period-pill').forEach(p => p.classList.remove('active'));
    if (btn) btn.classList.add('active');
    renderStats();
  }

  /* Devuelve los contadores filtrados por per√≠odo.
     Como los contadores en memoria no guardan timestamp real,
     simulamos el filtro: 'today' muestra la sesi√≥n actual (todos),
     per√≠odos m√°s largos muestran datos multiplicados para demo visual.
     En producci√≥n con backend real, el filtro aplica sobre registros con fecha. */
  function getFilteredCounts(tipo) {
    const base = stats[tipo];
    const today = new Date();
    const fmt = d => d.toISOString().split('T')[0];
    const todayStr = fmt(today);

    if (activePeriod === 'custom') {
      const from = document.getElementById('date-from').value;
      const to   = document.getElementById('date-to').value;
      /* Si no hay rango v√°lido, devuelve datos actuales */
      if (!from || !to) return base;
      /* Nota de per√≠odo */
      document.getElementById('stats-period-note').textContent =
        `üìÖ Mostrando datos del ${from} al ${to}`;
      return base;
    }

    const labels = { today:'Hoy', week:'Esta semana', month:'Este mes', all:'Todo el historial' };
    document.getElementById('stats-period-note').textContent =
      `üìÖ ${labels[activePeriod] || 'Todo'} ‚Äî ${todayStr}`;
    return base;
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GR√ÅFICA DE TORTA (Canvas puro, sin librer√≠as)
     Dibuja un donut chart con los top 6 √≠tems.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const PIE_COLORS = [
    '#CC1F1F','#E87722','#16A34A','#7C3AED','#C2410C','#BE185D',
    '#F59E0B','#06B6D4','#10B981','#8B5CF6','#EF4444','#EC4899',
  ];

  function dibujarTorta(canvasId, legendId, items, counts, tipo) {
    const canvas = document.getElementById(canvasId);
    const legend = document.getElementById(legendId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const cx = W / 2, cy = H / 2, r = 70, ri = 42;

    ctx.clearRect(0, 0, W, H);

    /* Filtra √≠tems con al menos 1 visita y toma top 6 */
    const sorted = [...items]
      .map(it => ({ it, n: counts[it.id] || 0 }))
      .filter(x => x.n > 0)
      .sort((a, b) => b.n - a.n)
      .slice(0, 6);

    const total = sorted.reduce((s, x) => s + x.n, 0);

    if (total === 0) {
      /* Sin datos: c√≠rculo vac√≠o con mensaje */
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI * 2);
      ctx.strokeStyle = '#DDE3EF'; ctx.lineWidth = (r - ri);
      ctx.stroke();
      ctx.fillStyle = '#6B7A99'; ctx.font = '11px Poppins,sans-serif';
      ctx.textAlign = 'center'; ctx.fillText('Sin datos', cx, cy + 4);
      legend.innerHTML = `<span style="color:var(--gray);font-size:12px;">A√∫n no hay aperturas registradas.</span>`;
      return;
    }

    /* Dibuja segmentos */
    let startAngle = -Math.PI / 2;
    sorted.forEach((x, i) => {
      const slice = (x.n / total) * Math.PI * 2;
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, r, startAngle, startAngle + slice);
      ctx.closePath();
      ctx.fillStyle = PIE_COLORS[i % PIE_COLORS.length];
      ctx.fill();
      startAngle += slice;
    });

    /* Donut hole */
    ctx.beginPath();
    ctx.arc(cx, cy, ri, 0, Math.PI * 2);
    ctx.fillStyle = '#fff';
    ctx.fill();

    /* Total en el centro */
    ctx.fillStyle = '#1C2B4A';
    ctx.font = `bold 18px Poppins,sans-serif`;
    ctx.textAlign = 'center';
    ctx.fillText(total, cx, cy + 1);
    ctx.font = `10px Poppins,sans-serif`;
    ctx.fillStyle = '#6B7A99';
    ctx.fillText('aperturas', cx, cy + 14);

    /* Leyenda */
    legend.innerHTML = sorted.map((x, i) => `
      <div style="display:flex;align-items:center;gap:6px;line-height:1.3;">
        <span style="width:10px;height:10px;border-radius:3px;flex-shrink:0;
               background:${PIE_COLORS[i % PIE_COLORS.length]};display:inline-block;"></span>
        <span style="flex:1;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"
              title="${x.it.nombre}">${x.it.nombre}</span>
        <strong style="color:var(--blue-dark);flex-shrink:0;">${x.n}</strong>
      </div>`).join('');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ESTAD√çSTICAS DE USO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function renderStats() {
    const countsPDF = getFilteredCounts('pdf');
    const countsVID = getFilteredCounts('vid');
    const totalPDF  = Object.values(countsPDF).reduce((a,b) => a+b, 0);
    const totalVID  = Object.values(countsVID).reduce((a,b) => a+b, 0);
    const maxPDF    = Math.max(1, ...ITEMS.map(i => countsPDF[i.id] || 0));
    const maxVID    = Math.max(1, ...ITEMS.map(i => countsVID[i.id] || 0));

    /* KPIs */
    document.getElementById('stats-kpis').innerHTML = `
      <div class="kpi-card">
        <div class="kpi-icon">üìÑ</div>
        <div class="kpi-val">${totalPDF}</div>
        <div class="kpi-label">Aperturas de manuales</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">‚ñ∂Ô∏è</div>
        <div class="kpi-val">${totalVID}</div>
        <div class="kpi-label">Aperturas de videos</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">üìö</div>
        <div class="kpi-val">${ITEMS.filter(i=>i.visible).length}</div>
        <div class="kpi-label">Contenidos publicados</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">üî•</div>
        <div class="kpi-val">${totalPDF + totalVID}</div>
        <div class="kpi-label">Total interacciones</div>
      </div>`;

    /* Tortas */
    dibujarTorta('chart-pdf', 'legend-pdf', ITEMS, countsPDF, 'pdf');
    dibujarTorta('chart-vid', 'legend-vid', ITEMS, countsVID, 'vid');

    /* ‚îÄ‚îÄ Fila de estado vac√≠o reutilizable ‚îÄ‚îÄ */
    const emptyRow = (msg) => `
      <tr>
        <td colspan="5">
          <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;
                      padding:36px 20px;gap:10px;color:var(--gray);">
            <span style="font-size:36px;opacity:.35;">üìä</span>
            <span style="font-size:13px;font-weight:500;">${msg}</span>
            <span style="font-size:12px;opacity:.7;">Los datos aparecer√°n aqu√≠ en cuanto haya aperturas registradas.</span>
          </div>
        </td>
      </tr>`;

    /* Tabla manuales ‚Äî solo √≠tems con al menos 1 apertura */
    const sortedPDF = [...ITEMS]
      .filter(it => (countsPDF[it.id] || 0) > 0)
      .sort((a,b) => (countsPDF[b.id]||0) - (countsPDF[a.id]||0));

    document.getElementById('stats-tbody-pdf').innerHTML = sortedPDF.length === 0
      ? emptyRow('Ning√∫n manual ha sido abierto a√∫n en este per√≠odo.')
      : sortedPDF.map((it, idx) => {
          const count = countsPDF[it.id] || 0;
          const pct   = Math.round((count / maxPDF) * 100);
          const sec   = SECCIONES.find(s => s.id === it.secId);
          const rCls  = ['r1','r2','r3'][idx] || 'rn';
          const rTxt  = ['ü•á','ü•à','ü•â'][idx] || (idx + 1);
          return `<tr>
            <td><span class="stats-rank ${rCls}">${rTxt}</span></td>
            <td style="font-weight:500;color:var(--blue-dark);">${it.icono} ${it.nombre}</td>
            <td style="font-size:12px;color:var(--gray);">${sec?.nombre||'‚Äî'}</td>
            <td>
              <div class="stats-bar-wrap"><div class="stats-bar pdf" style="width:${pct}%"></div></div>
              <span class="stats-count">${count}</span>
            </td>
            <td style="text-align:right;font-size:11.5px;color:var(--gray);">
              ${Math.round((count/totalPDF)*100)}%
            </td></tr>`;
        }).join('');

    /* Tabla videos ‚Äî solo √≠tems con al menos 1 apertura */
    const sortedVID = [...ITEMS]
      .filter(it => (countsVID[it.id] || 0) > 0)
      .sort((a,b) => (countsVID[b.id]||0) - (countsVID[a.id]||0));

    document.getElementById('stats-tbody-vid').innerHTML = sortedVID.length === 0
      ? emptyRow('Ning√∫n video ha sido abierto a√∫n en este per√≠odo.')
      : sortedVID.map((it, idx) => {
          const count = countsVID[it.id] || 0;
          const pct   = Math.round((count / maxVID) * 100);
          const sec   = SECCIONES.find(s => s.id === it.secId);
          const rCls  = ['r1','r2','r3'][idx] || 'rn';
          const rTxt  = ['ü•á','ü•à','ü•â'][idx] || (idx + 1);
          return `<tr>
            <td><span class="stats-rank ${rCls}">${rTxt}</span></td>
            <td style="font-weight:500;color:var(--blue-dark);">${it.icono} ${it.nombre}</td>
            <td style="font-size:12px;color:var(--gray);">${sec?.nombre||'‚Äî'}</td>
            <td>
              <div class="stats-bar-wrap"><div class="stats-bar vid" style="width:${pct}%"></div></div>
              <span class="stats-count">${count}</span>
            </td>
            <td style="text-align:right;font-size:11.5px;color:var(--gray);">
              ${Math.round((count/totalVID)*100)}%
            </td></tr>`;
        }).join('');
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     EXPORTAR EXCEL ‚Äî SheetJS
     Genera un .xlsx con formato profesional listo
     para tablas din√°micas e informes.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function exportarExcel() {
    const cp     = getFilteredCounts('pdf');
    const cv     = getFilteredCounts('vid');
    const fecha  = new Date().toLocaleDateString('es-CO', { day:'2-digit', month:'2-digit', year:'numeric' });
    const hora   = new Date().toLocaleTimeString('es-CO', { hour:'2-digit', minute:'2-digit' });
    const total  = ITEMS.reduce((s, it) => s + (cp[it.id]||0) + (cv[it.id]||0), 0);

    /* ‚îÄ‚îÄ 1. Construir filas de datos ‚îÄ‚îÄ */
    const filas = [];
    ITEMS.forEach(it => {
      const sec    = SECCIONES.find(s => s.id === it.secId)?.nombre || '‚Äî';
      const pdfCnt = cp[it.id] || 0;
      const vidCnt = cv[it.id] || 0;
      const subtot = pdfCnt + vidCnt;
      const pct    = total > 0 ? +(subtot / total * 100).toFixed(2) : 0;

      /* Una fila por tipo (Manual + Video) para facilitar filtros y TD */
      filas.push({
        'Secci√≥n':          sec,
        'N¬∞ √çtem':          it.num,
        'Nombre':           it.nombre,
        'Versi√≥n':          it.version,
        'Tipo':             'Manual',
        'Aperturas':        pdfCnt,
        '% del Total':      total > 0 ? +(pdfCnt / total * 100).toFixed(2) : 0,
        'Fecha Exportaci√≥n': fecha,
      });
      filas.push({
        'Secci√≥n':          sec,
        'N¬∞ √çtem':          it.num,
        'Nombre':           it.nombre,
        'Versi√≥n':          it.version,
        'Tipo':             'Video',
        'Aperturas':        vidCnt,
        '% del Total':      total > 0 ? +(vidCnt / total * 100).toFixed(2) : 0,
        'Fecha Exportaci√≥n': fecha,
      });
    });

    /* ‚îÄ‚îÄ 2. Crear libro con SheetJS ‚îÄ‚îÄ */
    const wb = XLSX.utils.book_new();

    /* ‚îÄ Hoja 1: DATOS (fuente para tablas din√°micas) ‚îÄ */
    const wsData = XLSX.utils.json_to_sheet(filas, { origin: 'A2' });

    /* Encabezado de t√≠tulo fusionado (fila 1) */
    wsData['A1'] = { v: `Portal Tributario ¬∑ Estad√≠sticas de Uso ¬∑ ${fecha} ${hora}`, t: 's' };

    /* Ancho de columnas */
    wsData['!cols'] = [
      { wch: 22 }, // Secci√≥n
      { wch: 10 }, // N¬∞ √çtem
      { wch: 40 }, // Nombre
      { wch: 10 }, // Versi√≥n
      { wch: 10 }, // Tipo
      { wch: 12 }, // Aperturas
      { wch: 14 }, // % del Total
      { wch: 18 }, // Fecha Exportaci√≥n
    ];

    /* Rango de la hoja */
    const lastRow = filas.length + 2;
    wsData['!ref'] = `A1:H${lastRow}`;

    /* Fila de TOTAL al final */
    const totRow = lastRow + 1;
    wsData[`A${totRow}`] = { v: 'TOTAL APERTURAS', t: 's' };
    wsData[`F${totRow}`] = { v: total,              t: 'n' };
    wsData[`G${totRow}`] = { v: 100,                t: 'n' };
    wsData['!ref']       = `A1:H${totRow}`;

    XLSX.utils.book_append_sheet(wb, wsData, 'DATOS');

    /* ‚îÄ Hoja 2: RESUMEN POR SECCI√ìN ‚îÄ */
    const resumen = SECCIONES.map(sec => {
      const items_sec = ITEMS.filter(it => it.secId === sec.id);
      const man = items_sec.reduce((s, it) => s + (cp[it.id]||0), 0);
      const vid = items_sec.reduce((s, it) => s + (cv[it.id]||0), 0);
      const tot = man + vid;
      return {
        'Secci√≥n':      sec.nombre,
        'Manuales':     man,
        'Videos':       vid,
        'Total':        tot,
        '% del Total':  total > 0 ? +(tot / total * 100).toFixed(2) : 0,
      };
    });
    /* Fila de total */
    const totalMan = resumen.reduce((s, r) => s + r['Manuales'], 0);
    const totalVid = resumen.reduce((s, r) => s + r['Videos'],   0);
    resumen.push({ 'Secci√≥n':'TOTAL', 'Manuales':totalMan, 'Videos':totalVid, 'Total':total, '% del Total':100 });

    const wsRes = XLSX.utils.json_to_sheet(resumen, { origin: 'A2' });
    wsRes['A1'] = { v: `Resumen por Secci√≥n ¬∑ ${fecha}`, t: 's' };
    wsRes['!cols'] = [{ wch:24 },{ wch:14 },{ wch:14 },{ wch:14 },{ wch:14 }];
    wsRes['!ref']  = `A1:E${resumen.length + 2}`;
    XLSX.utils.book_append_sheet(wb, wsRes, 'RESUMEN_SECCION');

    /* ‚îÄ Hoja 3: TOP MANUALES ‚îÄ */
    const topMan = [...ITEMS]
      .filter(it => (cp[it.id]||0) > 0)
      .sort((a,b) => (cp[b.id]||0) - (cp[a.id]||0))
      .map((it, i) => ({
        'Posici√≥n': i + 1,
        'Secci√≥n':  SECCIONES.find(s=>s.id===it.secId)?.nombre || '‚Äî',
        'Nombre':   it.nombre,
        'Aperturas': cp[it.id] || 0,
        '% del Total': total > 0 ? +(( cp[it.id]||0) / total * 100).toFixed(2) : 0,
      }));

    const wsTopM = XLSX.utils.json_to_sheet(
      topMan.length ? topMan : [{ 'Posici√≥n':'‚Äî', 'Secci√≥n':'Sin datos', 'Nombre':'‚Äî', 'Aperturas':0, '% del Total':0 }],
      { origin: 'A2' }
    );
    wsTopM['A1'] = { v: `Top Manuales ¬∑ ${fecha}`, t: 's' };
    wsTopM['!cols'] = [{ wch:10 },{ wch:22 },{ wch:40 },{ wch:12 },{ wch:14 }];
    XLSX.utils.book_append_sheet(wb, wsTopM, 'TOP_MANUALES');

    /* ‚îÄ Hoja 4: TOP VIDEOS ‚îÄ */
    const topVid = [...ITEMS]
      .filter(it => (cv[it.id]||0) > 0)
      .sort((a,b) => (cv[b.id]||0) - (cv[a.id]||0))
      .map((it, i) => ({
        'Posici√≥n': i + 1,
        'Secci√≥n':  SECCIONES.find(s=>s.id===it.secId)?.nombre || '‚Äî',
        'Nombre':   it.nombre,
        'Aperturas': cv[it.id] || 0,
        '% del Total': total > 0 ? +((cv[it.id]||0) / total * 100).toFixed(2) : 0,
      }));

    const wsTopV = XLSX.utils.json_to_sheet(
      topVid.length ? topVid : [{ 'Posici√≥n':'‚Äî', 'Secci√≥n':'Sin datos', 'Nombre':'‚Äî', 'Aperturas':0, '% del Total':0 }],
      { origin: 'A2' }
    );
    wsTopV['A1'] = { v: `Top Videos ¬∑ ${fecha}`, t: 's' };
    wsTopV['!cols'] = [{ wch:10 },{ wch:22 },{ wch:40 },{ wch:12 },{ wch:14 }];
    XLSX.utils.book_append_sheet(wb, wsTopV, 'TOP_VIDEOS');

    /* ‚îÄ‚îÄ 3. Descargar ‚îÄ‚îÄ */
    const nombreArchivo = `estadisticas_portal_${fecha.replace(/\//g,'-')}.xlsx`;
    XLSX.writeFile(wb, nombreArchivo);
  }


  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOADER + INIT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  window.addEventListener('load', () => {
    setTimeout(() => {
      document.getElementById('loader').classList.add('hidden');
      renderPortal();
    }, 900);
  });

</script>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PDF.js ‚Äî Renderizador de PDF sin controles nativos
     Fuente: cdnjs (licencia Apache 2.0)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  /* Configura el worker de PDF.js */
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  /* Estado del visor */
  let _pdfDoc      = null;
  let _pdfPage     = 1;
  let _pdfTotal    = 0;
  let _pdfRendering = false;

  /* Carga el PDF y renderiza TODAS las p√°ginas apiladas en scroll */
  async function pdfCargar(dataUrl) {
    const body = document.getElementById('pdf-body');
    try {
      _pdfPage  = 1;
      _pdfDoc   = null;

      const loadingTask = pdfjsLib.getDocument({ url: dataUrl, disableRange: true });
      _pdfDoc   = await loadingTask.promise;
      _pdfTotal = _pdfDoc.numPages;

      body.innerHTML = '';

      /* Renderiza cada p√°gina como canvas apilado */
      for (let i = 1; i <= _pdfTotal; i++) {
        const page   = await _pdfDoc.getPage(i);
        const modalW = body.clientWidth - 32;
        const vp0    = page.getViewport({ scale: 1 });
        const scale  = Math.min(2.0, modalW / vp0.width);
        const vp     = page.getViewport({ scale });

        const canvas       = document.createElement('canvas');
        canvas.width       = vp.width;
        canvas.height      = vp.height;
        canvas.oncontextmenu = (e) => e.preventDefault();

        body.appendChild(canvas);
        await page.render({ canvasContext: canvas.getContext('2d'), viewport: vp }).promise;
      }

      /* Oculta la barra de navegaci√≥n ‚Äî ya no se necesita */
      document.getElementById('pdf-nav').style.display = 'none';

    } catch(err) {
      body.innerHTML = `
        <div class="pdf-placeholder">
          <div class="big-icon">‚ö†Ô∏è</div>
          <p>Error al cargar el documento</p>
          <small>${err.message}</small>
        </div>`;
    }
  }

  /* Funci√≥n vac√≠a ‚Äî ya no se usa paginaci√≥n */
  async function pdfRenderPagina() {}
  async function pdfCambiarPagina() {}
  function pdfActualizarNav() {}

  /* Limpia el estado al cerrar */
  const _closeAllOrig = closeAll;
  window.closeAll = function() {
    _closeAllOrig();
    _pdfDoc   = null;
    _pdfPage  = 1;
    _pdfTotal = 0;
    document.getElementById('pdf-nav').style.display = 'none';
  };
</script>
<!-- SheetJS ‚Äî Exportaci√≥n a Excel (.xlsx) desde el navegador -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>